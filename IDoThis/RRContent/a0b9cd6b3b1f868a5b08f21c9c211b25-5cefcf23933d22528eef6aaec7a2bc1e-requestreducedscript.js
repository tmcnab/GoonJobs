var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"ï»¿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46},Base;window.rangy=function(){function t(n,t){var i=typeof n[t];return i==nt||!!(i==w&&n[t])||i=="unknown"}function f(n,t){return!!(typeof n[t]==w&&n[t])}function p(n,t){return typeof n[t]!=r}function y(n){return function(t,i){for(var r=i.length;r--;)if(!n(t,i[r]))return!1;return!0}}function b(n){return n&&l(n,tt)&&h(n,ut)}function i(t){window.alert("Rangy not supported in your browser. Reason: "+t),n.initialized=!0,n.supported=!1}function it(t){var i="Rangy warning: "+t;n.config.alertOnWarn?window.alert(i):typeof window.console!=r&&typeof window.console.log!=r&&window.console.log(i)}function s(){var r,o,s,u,c,e,y;if(!n.initialized)for(o=!1,s=!1,t(document,"createRange")&&(r=document.createRange(),l(r,rt)&&h(r,k)&&(o=!0),r.detach()),u=f(document,"body")?document.body:document.getElementsByTagName("body")[0],u&&t(u,"createTextRange")&&(r=u.createTextRange(),b(r)&&(s=!0)),o||s||i("Neither Range nor TextRange are implemented"),n.initialized=!0,n.features={implementsDomRange:o,implementsTextRange:s},c=a.concat(v),e=0,y=c.length;e<y;++e)try{c[e](n)}catch(p){f(window,"console")&&t(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",p)}}function d(n){n=n||window,s();for(var t=0,i=o.length;t<i;++t)o[t](n)}function u(n){this.name=n,this.initialized=!1,this.supported=!1}var w="object",nt="function",r="undefined",k=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],rt=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],ut=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],tt=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],l=y(t),g=y(f),h=y(p),n={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:f,isHostProperty:p,areHostMethods:l,areHostObjects:g,areHostProperties:h,isTextRange:b},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}},v,a,o,c,e;if(n.fail=i,n.warn=it,{}.hasOwnProperty?n.util.extend=function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])}:i("hasOwnProperty not supported"),v=[],a=[],n.init=s,n.addInitListener=function(t){n.initialized?t(n):v.push(t)},o=[],n.addCreateMissingNativeApiListener=function(n){o.push(n)},n.createMissingNativeApi=d,u.prototype.fail=function(n){this.initialized=!0,this.supported=!1;throw new Error("Module '"+this.name+"' failed to load: "+n);},u.prototype.warn=function(t){n.warn("Module "+this.name+": "+t)},u.prototype.createError=function(n){return new Error("Error in Rangy "+this.name+" module: "+n)},n.createModule=function(t,i){var r=new u(t);n.modules[t]=r,a.push(function(n){i(n,r),r.initialized=!0,r.supported=!0})},n.requireModules=function(t){for(var f=0,e=t.length,i,r;f<e;++f){if(r=t[f],i=n.modules[r],!i||!(i instanceof u))throw new Error("Module '"+r+"' not found");if(!i.supported)throw new Error("Module '"+r+"' not supported");}},c=!1,e=function(){c||(c=!0,n.initialized||s())},typeof window==r){i("No window found");return}if(typeof document==r){i("No document found");return}return t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",e,!1),t(window,"addEventListener")?window.addEventListener("load",e,!1):t(window,"attachEvent")?window.attachEvent("onload",e):i("Window does not have required addEventListener or attachEvent method"),n}(),rangy.createModule("DomUtil",function(n,t){function tt(n){var t;return typeof n.namespaceURI==r||(t=n.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function ut(n){var t=n.parentNode;return t.nodeType==1?t:null}function h(n){for(var t=0;n=n.previousSibling;)t++;return t}function g(n){var t;return s(n)?n.length:(t=n.childNodes)?t.length:0}function w(n,t){for(var r=[],i=n;i;i=i.parentNode)r.push(i);for(i=t;i;i=i.parentNode)if(c(r,i))return i;return null}function rt(n,t,i){for(var r=i?t:t.parentNode;r;){if(r===n)return!0;r=r.parentNode}return!1}function u(n,t,i){for(var u,r=i?n:n.parentNode;r;){if(u=r.parentNode,u===t)return r;r=u}return null}function s(n){var t=n.nodeType;return t==3||t==4||t==8}function a(n,t){var r=t.nextSibling,i=t.parentNode;return r?i.insertBefore(n,r):i.appendChild(n),n}function it(n,t){var i=n.cloneNode(!1);return i.deleteData(0,t),n.deleteData(t,n.length-t),a(i,n),i}function e(n){if(n.nodeType==9)return n;if(typeof n.ownerDocument!=r)return n.ownerDocument;if(typeof n.document!=r)return n.document;if(n.parentNode)return e(n.parentNode);throw new Error("getDocument: no document found for node");}function ot(n){var t=e(n);if(typeof t.defaultView!=r)return t.defaultView;if(typeof t.parentWindow!=r)return t.parentWindow;throw new Error("Cannot get a window object for node");}function st(n){if(typeof n.contentDocument!=r)return n.contentDocument;if(typeof n.contentWindow!=r)return n.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element");}function ft(n){if(typeof n.contentWindow!=r)return n.contentWindow;if(typeof n.contentDocument!=r)return n.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element");}function et(n){return i.isHostObject(n,"body")?n.body:n.getElementsByTagName("body")[0]}function k(n){for(var t;t=n.parentNode;)n=t;return n}function b(n,t,i,r){var o,f,s,c,e;if(n==i)return t===r?0:t<r?-1:1;if(o=u(i,n,!0))return t<=h(o)?-1:1;if(o=u(n,i,!0))return h(o)<r?-1:1;if(f=w(n,i),s=n===f?f:u(n,f,!0),c=i===f?f:u(i,f,!0),s===c)throw new Error("comparePoints got to case 4 and childA and childB are the same!");else{for(e=f.firstChild;e;){if(e===s)return-1;if(e===c)return 1;e=e.nextSibling}throw new Error("Should not be here!");}}function d(n){for(var i=e(n).createDocumentFragment(),t;t=n.firstChild;)i.appendChild(t);return i}function y(n){if(!n)return"[No node]";if(s(n))return'"'+n.data+'"';if(n.nodeType==1){var t=n.id?' id="'+n.id+'"':"";return"<"+n.nodeName+t+">["+n.childNodes.length+"]"}return n.nodeName}function v(n){this.root=n,this._next=n}function nt(n){return new v(n)}function p(n,t){this.node=n,this.offset=t}function o(n){this.code=this[n],this.codeName=n,this.message="DOMException: "+this.codeName}var r="undefined",i=n.util,f,l,c;i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),i.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method"),f=document.createElement("div"),i.areHostMethods(f,["insertBefore","appendChild","cloneNode"]||!i.areHostObjects(f,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),i.isHostProperty(f,"innerHTML")||t.fail("Element is missing innerHTML property"),l=document.createTextNode("test"),i.areHostMethods(l,["splitText","deleteData","insertData","appendData","cloneNode"]||!i.areHostObjects(f,["previousSibling","nextSibling","childNodes","parentNode"])||!i.areHostProperties(l,["data"]))||t.fail("Incomplete Text Node implementation"),c=function(n,t){for(var i=n.length;i--;)if(n[i]===t)return!0;return!1},v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next,i,t;if(this._current)if(i=n.firstChild,i)this._next=i;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},p.prototype={equals:function(n){return this.node===n.node&this.offset==n.offset},inspect:function(){return"[DomPosition("+y(this.node)+":"+this.offset+")]"}},o.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},o.prototype.toString=function(){return this.message},n.dom={arrayContains:c,isHtmlNamespace:tt,parentElement:ut,getNodeIndex:h,getNodeLength:g,getCommonAncestor:w,isAncestorOf:rt,getClosestAncestorIn:u,isCharacterDataNode:s,insertAfter:a,splitDataNode:it,getDocument:e,getWindow:ot,getIframeWindow:ft,getIframeDocument:st,getBody:et,getRootContainer:k,comparePoints:b,inspectNode:y,fragmentFromNodeChildren:d,createIterator:nt,DomPosition:p},n.DOMException=o}),rangy.createModule("DomRange",function(n){function y(n,t){return n.nodeType!=3&&(i.isAncestorOf(n,t.startContainer,!0)||i.isAncestorOf(n,t.endContainer,!0))}function u(n){return i.getDocument(n.startContainer)}function ci(n,t,i){var u=n._listeners[t],r,f;if(u)for(r=0,f=u.length;r<f;++r)u[r].call(n,{target:n,args:i})}function hi(n){return new st(n.parentNode,i.getNodeIndex(n))}function tt(n){return new st(n.parentNode,i.getNodeIndex(n)+1)}function si(n,t,r){var u=n.nodeType==11?n.firstChild:n;return i.isCharacterDataNode(t)?r==t.length?i.insertAfter(n,t):t.parentNode.insertBefore(n,r==0?t:i.splitDataNode(t,r)):r>=t.childNodes.length?t.appendChild(n):t.insertBefore(n,t.childNodes[r]),u}function dt(n){for(var f,t,i,r=u(n.range).createDocumentFragment();t=n.next();){if(f=n.isPartiallySelectedSubtree(),t=t.cloneNode(!f),f&&(i=n.getSubtreeIterator(),t.appendChild(dt(i)),i.detach(!0)),t.nodeType==10)throw new o("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function p(n,t,r){var e,o,u,f;for(r=r||{stop:!1};u=n.next();)if(n.isPartiallySelectedSubtree()){if(t(u)===!1){r.stop=!0;return}if(f=n.getSubtreeIterator(),p(f,t,r),f.detach(!0),r.stop)return}else for(e=i.createIterator(u);o=e.next();)if(t(o)===!1){r.stop=!0;return}}function ri(n){for(var t;n.next();)n.isPartiallySelectedSubtree()?(t=n.getSubtreeIterator(),ri(t),t.detach(!0)):n.remove()}function fi(n){for(var t,r=u(n.range).createDocumentFragment(),i;t=n.next();){if(n.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=n.getSubtreeIterator(),t.appendChild(fi(i)),i.detach(!0)):n.remove(),t.nodeType==10)throw new o("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function ni(n,t,i){var u=!!(t&&t.length),f,e=!!i,r;return u&&(f=new RegExp("^("+t.join("|")+")$")),r=[],p(new s(n,!1),function(n){(!u||f.test(n.nodeType))&&(!e||i(n))&&r.push(n)}),r}function gt(n){var t=typeof n.getName=="undefined"?"Range":n.getName();return"["+t+"("+i.inspectNode(n.startContainer)+":"+n.startOffset+", "+i.inspectNode(n.endContainer)+":"+n.endOffset+")]"}function s(n,t){if(this.range=n,this.clonePartiallySelectedTextNodes=t,!n.collapsed){this.sc=n.startContainer,this.so=n.startOffset,this.ec=n.endContainer,this.eo=n.endOffset;var r=n.commonAncestorContainer;this.sc===this.ec&&i.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!i.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:i.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!i.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:i.getClosestAncestorIn(this.ec,r,!0))}}function h(n){this.code=this[n],this.codeName=n,this.message="RangeException: "+this.codeName}function ii(n,t,i){this.nodes=ni(n,t,i),this._next=this.nodes[0],this._position=0}function k(n){return function(t,r){for(var f,u=r?t:t.parentNode;u;){if(f=u.nodeType,i.arrayContains(n,f))return u;u=u.parentNode}return null}}function l(n,t){if(ai(n,t))throw new h("INVALID_NODE_TYPE_ERR");}function e(n){if(!n.startContainer)throw new o("INVALID_STATE_ERR");}function a(n,t){if(!i.arrayContains(t,n.nodeType))throw new h("INVALID_NODE_TYPE_ERR");}function d(n,t){if(t<0||t>(i.isCharacterDataNode(n)?n.length:n.childNodes.length))throw new o("INDEX_SIZE_ERR");}function et(n,t){if(nt(n,!0)!==nt(t,!0))throw new o("WRONG_DOCUMENT_ERR");}function c(n){if(pi(n,!0))throw new o("NO_MODIFICATION_ALLOWED_ERR");}function w(n,t){if(!n)throw new o(t);}function ei(n){return!i.arrayContains(ui,n.nodeType)&&!nt(n,!0)}function oi(n,t){return t<=(i.isCharacterDataNode(n)?n.length:n.childNodes.length)}function r(n){if(e(n),ei(n.startContainer)||ei(n.endContainer)||!oi(n.startContainer,n.startOffset)||!oi(n.endContainer,n.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+n.inspect()+")");}function ft(){}function bt(n){n.START_TO_START=g,n.START_TO_END=ot,n.END_TO_END=vi,n.END_TO_START=pt,n.NODE_BEFORE=yt,n.NODE_AFTER=wt,n.NODE_BEFORE_AND_AFTER=kt,n.NODE_INSIDE=it}function ct(n){bt(n),bt(n.prototype)}function ht(n,t){return function(){var h;r(this);var u=this.startContainer,o=this.startOffset,l=this.commonAncestorContainer,f=new s(this,!0),a,e;return u!==l&&(a=i.getClosestAncestorIn(u,l,!0),e=tt(a),u=e.node,o=e.offset),p(f,c),f.reset(),h=n(f),f.detach(),t(this,u,o,u,o),h}}function lt(t,u,f){function o(n,t){return function(i){e(this),a(i,ti),a(v(i),ui);var r=(n?hi:tt)(i);(t?p:h)(this,r.node,r.offset)}}function p(n,t,r){var f=n.endContainer,e=n.endOffset;(t!==n.startContainer||r!==n.startOffset)&&((v(t)!=v(f)||i.comparePoints(t,r,f,e)==1)&&(f=t,e=r),u(n,t,r,f,e))}function h(n,t,r){var f=n.startContainer,e=n.startOffset;(t!==n.endContainer||r!==n.endOffset)&&((v(t)!=v(f)||i.comparePoints(t,r,f,e)==-1)&&(f=t,e=r),u(n,f,e,t,r))}function w(n,t,i){(t!==n.startContainer||i!==n.startOffset||t!==n.endContainer||i!==n.endOffset)&&u(n,t,i,t,i)}t.prototype=new ft,n.util.extend(t.prototype,{setStart:function(n,t){e(this),l(n,!0),d(n,t),p(this,n,t)},setEnd:function(n,t){e(this),l(n,!0),d(n,t),h(this,n,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(n){r(this),n?u(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):u(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(n){e(this),l(n,!0),u(this,n,0,n,i.getNodeLength(n))},selectNode:function(n){e(this),l(n,!1),a(n,ti);var i=hi(n),t=tt(n);u(this,i.node,i.offset,t.node,t.offset)},extractContents:ht(fi,u),deleteContents:ht(ri,u),canSurroundContents:function(){r(this),c(this.startContainer),c(this.endContainer);var n=new s(this,!0),t=n._first&&y(n._first,this)||n._last&&y(n._last,this);return n.detach(),!t},detach:function(){f(this)},splitBoundaries:function(){r(this);var n=this.startContainer,e=this.startOffset,f=this.endContainer,t=this.endOffset,o=n===f;i.isCharacterDataNode(f)&&t>0&&t<f.length&&i.splitDataNode(f,t),i.isCharacterDataNode(n)&&e>0&&e<n.length&&(n=i.splitDataNode(n,e),o?(t-=e,f=n):f==n.parentNode&&t>=i.getNodeIndex(n)&&t++,e=0),u(this,n,e,f,t)},normalizeBoundaries:function(){var o,s;r(this);var f=this.startContainer,e=this.startOffset,t=this.endContainer,n=this.endOffset,h=function(i){var r=i.nextSibling;r&&r.nodeType==i.nodeType&&(t=i,n=i.length,i.appendData(r.data),r.parentNode.removeChild(r))},c=function(r){var u=r.previousSibling,s,o;u&&u.nodeType==r.nodeType&&(f=r,s=r.length,e=u.length,r.insertData(0,u.data),u.parentNode.removeChild(u),f==t?(n+=e,t=f):t==r.parentNode&&(o=i.getNodeIndex(r),n==o?(t=r,n=s):n>o&&n--))},l=!0;i.isCharacterDataNode(t)?t.length==n&&h(t):(n>0&&(o=t.childNodes[n-1],o&&i.isCharacterDataNode(o)&&h(o)),l=!this.collapsed),l?i.isCharacterDataNode(f)?e==0&&c(f):e<f.childNodes.length&&(s=f.childNodes[e],s&&i.isCharacterDataNode(s)&&c(s)):(f=t,e=n),u(this,f,e,t,n)},collapseToPoint:function(n,t){e(this),l(n,!0),d(n,t),w(this,n,t)}}),ct(t)}function vt(n){n.collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset,n.commonAncestorContainer=n.collapsed?n.startContainer:i.getCommonAncestor(n.startContainer,n.endContainer)}function at(n,t,i,r,u){var e=n.startContainer!==t||n.startOffset!==i,f=n.endContainer!==r||n.endOffset!==u;n.startContainer=t,n.startOffset=i,n.endContainer=r,n.endOffset=u,vt(n),ci(n,"boundarychange",{startMoved:e,endMoved:f})}function li(n){e(n),n.startContainer=n.startOffset=n.endContainer=n.endOffset=null,n.collapsed=n.commonAncestorContainer=null,ci(n,"detach",null),n._listeners=null}function f(n){this.startContainer=n,this.startOffset=0,this.endContainer=n,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},vt(this)}var ut,b;n.requireModules(["DomUtil"]);var i=n.dom,st=i.DomPosition,o=n.DOMException;s.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next;return n&&(this._next=n!==this._last?n.nextSibling:null,i.isCharacterDataNode(n)&&this.clonePartiallySelectedTextNodes&&(n===this.ec&&(n=n.cloneNode(!0)).deleteData(this.eo,n.length-this.eo),this._current===this.sc&&(n=n.cloneNode(!0)).deleteData(0,this.so))),n},remove:function(){var n=this._current,t,r;i.isCharacterDataNode(n)&&(n===this.sc||n===this.ec)?(t=n===this.sc?this.so:0,r=n===this.ec?this.eo:n.length,t!=r&&n.deleteData(t,r-t)):n.parentNode&&n.parentNode.removeChild(n)},isPartiallySelectedSubtree:function(){var n=this._current;return y(n,this.range)},getSubtreeIterator:function(){var t;if(this.isSingleCharacterDataNode)t=this.range.cloneRange(),t.collapse();else{t=new f(u(this.range));var n=this._current,o=n,h=0,r=n,e=i.getNodeLength(n);i.isAncestorOf(n,this.sc,!0)&&(o=this.sc,h=this.so),i.isAncestorOf(n,this.ec,!0)&&(r=this.ec,e=this.eo),at(t,o,h,r,e)}return new s(t,this.clonePartiallySelectedTextNodes)},detach:function(n){n&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},h.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},h.prototype.toString=function(){return this.message},ii.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var ti=[1,3,4,5,7,8,10],ui=[2,9,11],wi=[5,6,10,12],bi=[1,3,4,5,7,8,10,11],ki=[1,3,4,5,7,8];var v=i.getRootContainer,nt=k([9,11]),pi=k(wi),ai=k([6,10,12]);ut=document.createElement("style"),b=!1;try{ut.innerHTML="<b>x<\/b>",b=ut.firstChild.nodeType==3}catch(di){}n.features.htmlParsingConforms=b;var yi=b?function(n){var r=this.startContainer,u=i.getDocument(r),t;if(!r)throw new o("INVALID_STATE_ERR");return t=null,r.nodeType==1?t=r:i.isCharacterDataNode(r)&&(t=i.parentElement(r)),t=t===null||t.nodeName=="HTML"&&i.isHtmlNamespace(i.getDocument(t).documentElement)&&i.isHtmlNamespace(t)?u.createElement("body"):t.cloneNode(!1),t.innerHTML=n,i.fragmentFromNodeChildren(t)}:function(n){e(this);var r=u(this),t=r.createElement("body");return t.innerHTML=n,i.fragmentFromNodeChildren(t)},rt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],g=0,ot=1,vi=2,pt=3,yt=0,wt=1,kt=2,it=3;ft.prototype={attachListener:function(n,t){this._listeners[n].push(t)},compareBoundaryPoints:function(n,t){r(this),et(this.startContainer,t.startContainer);var o,s,h,u,f=n==pt||n==g?"start":"end",e=n==ot||n==g?"start":"end";return o=this[f+"Container"],s=this[f+"Offset"],h=t[e+"Container"],u=t[e+"Offset"],i.comparePoints(o,s,h,u)},insertNode:function(n){if(r(this),a(n,bi),c(this.startContainer),i.isAncestorOf(n,this.startContainer,!0))throw new o("HIERARCHY_REQUEST_ERR");var t=si(n,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var n,f,t;return r(this),this.collapsed?u(this).createDocumentFragment():this.startContainer===this.endContainer&&i.isCharacterDataNode(this.startContainer)?(n=this.startContainer.cloneNode(!0),n.data=n.data.slice(this.startOffset,this.endOffset),f=u(this).createDocumentFragment(),f.appendChild(n),f):(t=new s(this,!0),n=dt(t),t.detach(),n)},canSurroundContents:function(){r(this),c(this.startContainer),c(this.endContainer);var n=new s(this,!0),t=n._first&&y(n._first,this)||n._last&&y(n._last,this);return n.detach(),!t},surroundContents:function(n){if(a(n,ki),!this.canSurroundContents())throw new h("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(n.hasChildNodes())while(n.lastChild)n.removeChild(n.lastChild);si(n,this.startContainer,this.startOffset),n.appendChild(t),this.selectNode(n)},cloneRange:function(){r(this);for(var t=new f(u(this)),i=rt.length,n;i--;)n=rt[i],t[n]=this[n];return t},toString:function(){var n,u,t;return r(this),n=this.startContainer,n===this.endContainer&&i.isCharacterDataNode(n)?n.nodeType==3||n.nodeType==4?n.data.slice(this.startOffset,this.endOffset):"":(u=[],t=new s(this,!0),p(t,function(n){(n.nodeType==3||n.nodeType==4)&&u.push(n.data)}),t.detach(),u.join(""))},compareNode:function(n){var t,f,e,u;if(r(this),t=n.parentNode,f=i.getNodeIndex(n),!t)throw new o("NOT_FOUND_ERR");return e=this.comparePoint(t,f),u=this.comparePoint(t,f+1),e<0?u>0?kt:yt:u>0?wt:it},comparePoint:function(n,t){return(r(this),w(n,"HIERARCHY_REQUEST_ERR"),et(n,this.startContainer),i.comparePoints(n,t,this.startContainer,this.startOffset)<0)?-1:i.comparePoints(n,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:yi,toHtml:function(){r(this);var n=u(this).createElement("div");return n.appendChild(this.cloneContents()),n.innerHTML},intersectsNode:function(n,t){var f,s,o,e;return(r(this),w(n,"NOT_FOUND_ERR"),i.getDocument(n)!==u(this))?!1:(f=n.parentNode,s=i.getNodeIndex(n),w(f,"NOT_FOUND_ERR"),o=i.comparePoints(f,s,this.endContainer,this.endOffset),e=i.comparePoints(f,s+1,this.startContainer,this.startOffset),t?o<=0&&e>=0:o<0&&e>0)},isPointInRange:function(n,t){return r(this),w(n,"HIERARCHY_REQUEST_ERR"),et(n,this.startContainer),i.comparePoints(n,t,this.startContainer,this.startOffset)>=0&&i.comparePoints(n,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(n,t){if(r(this),u(n)!=u(this))throw new o("WRONG_DOCUMENT_ERR");var e=i.comparePoints(this.startContainer,this.startOffset,n.endContainer,n.endOffset),f=i.comparePoints(this.endContainer,this.endOffset,n.startContainer,n.startOffset);return t?e<=0&&f>=0:e<0&&f>0},intersection:function(n){if(this.intersectsRange(n)){var r=i.comparePoints(this.startContainer,this.startOffset,n.startContainer,n.startOffset),u=i.comparePoints(this.endContainer,this.endOffset,n.endContainer,n.endOffset),t=this.cloneRange();return r==-1&&t.setStart(n.startContainer,n.startOffset),u==1&&t.setEnd(n.endContainer,n.endOffset),t}return null},union:function(n){if(this.intersectsRange(n,!0)){var t=this.cloneRange();return i.comparePoints(n.startContainer,n.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(n.startContainer,n.startOffset),i.comparePoints(n.endContainer,n.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(n.endContainer,n.endOffset),t}throw new h("Ranges do not intersect");},containsNode:function(n,t){return t?this.intersectsNode(n,!1):this.compareNode(n)==it},containsNodeContents:function(n){return this.comparePoint(n,0)>=0&&this.comparePoint(n,i.getNodeLength(n))<=0},containsRange:function(n){return this.intersection(n).equals(n)},containsNodeText:function(n){var t=this.cloneRange(),i,r,u;return t.selectNode(n),i=t.getNodes([3]),i.length>0?(t.setStart(i[0],0),r=i.pop(),t.setEnd(r,r.length),u=this.containsRange(t),t.detach(),u):this.containsNodeContents(n)},createNodeIterator:function(n,t){return r(this),new ii(this,n,t)},getNodes:function(n,t){return r(this),ni(this,n,t)},getDocument:function(){return u(this)},collapseBefore:function(n){e(this),this.setEndBefore(n),this.collapse(!1)},collapseAfter:function(n){e(this),this.setStartAfter(n),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(n){return f.rangesEqual(this,n)},inspect:function(){return gt(this)}},lt(f,at,li),n.rangePrototype=ft.prototype,f.rangeProperties=rt,f.RangeIterator=s,f.copyComparisonConstants=ct,f.createPrototypeRange=lt,f.inspect=gt,f.getRangeDocument=u,f.rangesEqual=function(n,t){return n.startContainer===t.startContainer&&n.startOffset===t.startOffset&&n.endContainer===t.endContainer&&n.endOffset===t.endOffset},n.DomRange=f,n.RangeException=h}),rangy.createModule("WrappedRange",function(n){function h(n){var e=n.parentElement(),t=n.duplicate(),u,f,r;return t.collapse(!0),u=t.parentElement(),t=n.duplicate(),t.collapse(!1),f=t.parentElement(),r=u==f?u:i.getCommonAncestor(u,f),r==e?r:i.getCommonAncestor(e,r)}function c(n){return n.compareEndPoints("StartToEnd",n)==0}function s(n,t,r,f){var s=n.duplicate(),o,e,p,b,l,y,c,a,v,h,w;if(s.collapse(r),o=s.parentElement(),i.isAncestorOf(t,o,!0)||(o=t),!o.canHaveHTML)return new u(o.parentNode,i.getNodeIndex(o));e=i.getDocument(o).createElement("span"),b=r?"StartToStart":"StartToEnd";do o.insertBefore(e,e.previousSibling),s.moveToElementText(e);while((p=s.compareEndPoints(b,n))>0&&e.previousSibling);if(a=e.nextSibling,p==-1&&a&&i.isCharacterDataNode(a)){if(s.setEndPoint(r?"EndToStart":"EndToEnd",n),/[\r\n]/.test(a.data))for(h=s.duplicate(),w=h.text.replace(/\r\n/g,"\r").length,v=h.moveStart("character",w);(p=h.compareEndPoints("StartToEnd",h))==-1;)v++,h.moveStart("character",1);else v=s.text.length;c=new u(a,v)}else l=(f||!r)&&e.previousSibling,y=(f||r)&&e.nextSibling,c=y&&i.isCharacterDataNode(y)?new u(y,0):l&&i.isCharacterDataNode(l)?new u(l,l.length):new u(o,i.getNodeIndex(e));return e.parentNode.removeChild(e),c}function o(n,t){var f,u,s=n.offset,c=i.getDocument(n.node),r,o,e=c.body.createTextRange(),h=i.isCharacterDataNode(n.node);return h?(f=n.node,u=f.parentNode):(o=n.node.childNodes,f=s<o.length?o[s]:null,u=n.node),r=c.createElement("span"),r.innerHTML="&#feff;",f?u.insertBefore(r,f):u.appendChild(r),e.moveToElementText(r),e.collapse(!t),u.removeChild(r),h&&e[t?"moveStart":"moveEnd"]("character",s),e}var e;n.requireModules(["DomUtil","DomRange"]);var r,i=n.dom,u=i.DomPosition,f=n.DomRange;!n.features.implementsDomRange||n.features.implementsTextRange&&n.config.preferTextRange?n.features.implementsTextRange&&(r=function(n){this.textRange=n,this.refresh()},r.prototype=new f(document),r.prototype.refresh=function(){var t,n,i=h(this.textRange);c(this.textRange)?n=t=s(this.textRange,i,!0,!0):(t=s(this.textRange,i,!0,!1),n=s(this.textRange,i,!1,!1)),this.setStart(t.node,t.offset),this.setEnd(n.node,n.offset)},f.copyComparisonConstants(r),e=function(){return this}(),typeof e.Range=="undefined"&&(e.Range=r),n.createNativeRange=function(n){return n=n||document,n.body.createTextRange()}):(function(){function o(n){for(var i=c.length,t;i--;)t=c[i],n[t]=n.nativeRange[t]}function a(n,t,i,r,u){var e=n.startContainer!==t||n.startOffset!=i,f=n.endContainer!==r||n.endOffset!=u;(e||f)&&(n.setEnd(r,u),n.setStart(t,i))}function v(n){n.nativeRange.detach(),n.detached=!0;for(var i=c.length,t;i--;)t=c[i],n[t]=null}var t,c=f.rangeProperties,l,h,e,u,s;r=function(n){if(!n)throw new Error("Range must be specified");this.nativeRange=n,o(this)},f.createPrototypeRange(r,a,v),t=r.prototype,t.selectNode=function(n){this.nativeRange.selectNode(n),o(this)},t.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},t.extractContents=function(){var n=this.nativeRange.extractContents();return o(this),n},t.cloneContents=function(){return this.nativeRange.cloneContents()},t.surroundContents=function(n){this.nativeRange.surroundContents(n),o(this)},t.collapse=function(n){this.nativeRange.collapse(n),o(this)},t.cloneRange=function(){return new r(this.nativeRange.cloneRange())},t.refresh=function(){o(this)},t.toString=function(){return this.nativeRange.toString()},e=document.createTextNode("test"),i.getBody(document).appendChild(e),u=document.createRange(),u.setStart(e,0),u.setEnd(e,0);try{u.setStart(e,1),l=!0,t.setStart=function(n,t){this.nativeRange.setStart(n,t),o(this)},t.setEnd=function(n,t){this.nativeRange.setEnd(n,t),o(this)},h=function(n){return function(t){this.nativeRange[n](t),o(this)}}}catch(y){l=!1,t.setStart=function(n,t){try{this.nativeRange.setStart(n,t)}catch(i){this.nativeRange.setEnd(n,t),this.nativeRange.setStart(n,t)}o(this)},t.setEnd=function(n,t){try{this.nativeRange.setEnd(n,t)}catch(i){this.nativeRange.setStart(n,t),this.nativeRange.setEnd(n,t)}o(this)},h=function(n,t){return function(i){try{this.nativeRange[n](i)}catch(r){this.nativeRange[t](i),this.nativeRange[n](i)}o(this)}}}t.setStartBefore=h("setStartBefore","setEndBefore"),t.setStartAfter=h("setStartAfter","setEndAfter"),t.setEndBefore=h("setEndBefore","setStartBefore"),t.setEndAfter=h("setEndAfter","setStartAfter"),u.selectNodeContents(e),t.selectNodeContents=u.startContainer==e&&u.endContainer==e&&u.startOffset==0&&u.endOffset==e.length?function(n){this.nativeRange.selectNodeContents(n),o(this)}:function(n){this.setStart(n,0),this.setEnd(n,f.getEndOffset(n))},u.selectNodeContents(e),u.setEnd(e,3),s=document.createRange(),s.selectNodeContents(e),s.setEnd(e,4),s.setStart(e,2),t.compareBoundaryPoints=u.compareBoundaryPoints(u.START_TO_END,s)==-1&u.compareBoundaryPoints(u.END_TO_START,s)==1?function(n,t){return t=t.nativeRange||t,n==t.START_TO_END?n=t.END_TO_START:n==t.END_TO_START&&(n=t.START_TO_END),this.nativeRange.compareBoundaryPoints(n,t)}:function(n,t){return this.nativeRange.compareBoundaryPoints(n,t.nativeRange||t)},n.util.isHostMethod(u,"createContextualFragment")&&(t.createContextualFragment=function(n){return this.nativeRange.createContextualFragment(n)}),i.getBody(document).removeChild(e),u.detach(),s.detach()}(),n.createNativeRange=function(n){return n=n||document,n.createRange()}),n.features.implementsTextRange&&(r.rangeToTextRange=function(n){var r;if(n.collapsed)return r=o(new u(n.startContainer,n.startOffset),!0);var f=o(new u(n.startContainer,n.startOffset),!0),e=o(new u(n.endContainer,n.endOffset),!1),t=i.getDocument(n.startContainer).body.createTextRange();return t.setEndPoint("StartToStart",f),t.setEndPoint("EndToEnd",e),t}),r.prototype.getName=function(){return"WrappedRange"},n.WrappedRange=r,n.createRange=function(t){return t=t||document,new r(n.createNativeRange(t))},n.createRangyRange=function(n){return n=n||document,new f(n)},n.createIframeRange=function(t){return n.createRange(i.getIframeDocument(t))},n.createIframeRangyRange=function(t){return n.createRangyRange(i.getIframeDocument(t))},n.addCreateMissingNativeApiListener(function(t){var i=t.document;typeof i.createRange=="undefined"&&(i.createRange=function(){return n.createRange(this)}),i=t=null})}),rangy.createModule("WrappedSelection",function(n,t){function ui(n){return(n||window).getSelection()}function vt(n){return(n||window).document.selection}function v(n,t,i){var u=i?"end":"start",r=i?"start":"end";n.anchorNode=t[u+"Container"],n.anchorOffset=t[u+"Offset"],n.focusNode=t[r+"Container"],n.focusOffset=t[r+"Offset"]}function ri(n){var t=n.nativeSelection;n.anchorNode=t.anchorNode,n.anchorOffset=t.anchorOffset,n.focusNode=t.focusNode,n.focusOffset=t.focusOffset}function s(n){n.anchorNode=n.focusNode=null,n.anchorOffset=n.focusOffset=0,n.rangeCount=0,n.isCollapsed=!0,n._ranges.length=0}function et(t){var i;return t instanceof c?(i=t._selectionNativeRange,i||(i=n.createNativeRange(r.getDocument(t.startContainer)),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=i,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof g?i=t.nativeRange:n.features.implementsDomRange&&t instanceof r.getWindow(t.startContainer).Range&&(i=t),i}function fi(n){if(!n.length||n[0].nodeType!=1)return!1;for(var t=1,i=n.length;t<i;++t)if(!r.isAncestorOf(n[0],n[t]))return!1;return!0}function ot(n){var t=n.getNodes();if(!fi(t))throw new Error("getSingleElementFromRange: range "+n.inspect()+" did not consist of a single element");return t[0]}function kt(n){return!!n&&typeof n.text!="undefined"}function ii(n,t){var i=new g(t);n._ranges=[i],v(n,i,!1),n.rangeCount=1,n.isCollapsed=i.collapsed}function y(t){var i,f,e,u;if(t._ranges.length=0,t.docSelection.type=="None")s(t);else if(i=t.docSelection.createRange(),kt(i))ii(t,i);else{for(t.rangeCount=i.length,e=r.getDocument(i.item(0)),u=0;u<t.rangeCount;++u)f=n.createRange(e),f.selectNode(i.item(u)),t._ranges.push(f);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,v(t,t._ranges[t.rangeCount-1],!1)}}function ti(n,t){for(var f=n.docSelection.createRange(),o=ot(t),s=r.getDocument(f.item(0)),u=r.getBody(s).createControlRange(),i=0,e=f.length;i<e;++i)u.add(f.item(i));try{u.add(o)}catch(h){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}u.select(),y(n)}function it(n,t,i){this.nativeSelection=n,this.docSelection=t,this._ranges=[],this.win=i,this.refresh()}function yt(n,t){for(var e=r.getDocument(t[0].startContainer),f=r.getBody(e).createControlRange(),u,i=0;i<rangeCount;++i){u=ot(t[i]);try{f.add(u)}catch(o){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}f.select(),y(n)}function pt(n,t){if(n.anchorNode&&r.getDocument(n.anchorNode)!==r.getDocument(t))throw new nt("WRONG_DOCUMENT_ERR");}function ni(n){var r=[],f=new bt(n.anchorNode,n.anchorOffset),u=new bt(n.focusNode,n.focusOffset),e=typeof n.getName=="function"?n.getName():"Selection",t,i;if(typeof n.rangeCount!="undefined")for(t=0,i=n.rangeCount;t<i;++t)r[t]=c.inspect(n.getRangeAt(t));return"["+e+"(Ranges: "+r.join(", ")+")(anchor: "+f.inspect()+", focus: "+u.inspect()+"]"}var ut,ht,tt,ct,e,dt,rt,i,st,d,ft,k;n.requireModules(["DomUtil","DomRange","WrappedRange"]),n.config.checkSelectionRanges=!0;var wt="boolean",lt="_rangySelection",r=n.dom,f=n.util,c=n.DomRange,g=n.WrappedRange,nt=n.DOMException,bt=r.DomPosition,w,b,o="Control";var at=n.util.isHostMethod(window,"getSelection"),l=n.util.isHostObject(document,"selection"),a=l&&(!at||n.config.preferTextRange);a?(w=vt,n.isSelectionValid=function(n){var i=(n||window).document,t=i.selection;return t.type!="None"||r.getDocument(t.createRange().parentElement())==i}):at?(w=ui,n.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),n.getNativeSelection=w;var u=w(),gt=n.createNativeRange(document),p=r.getBody(document),h=f.areHostObjects(u,["anchorNode","focusNode"]&&f.areHostProperties(u,["anchorOffset","focusOffset"]));if(n.features.selectionHasAnchorAndFocus=h,ut=f.isHostMethod(u,"extend"),n.features.selectionHasExtend=ut,ht=typeof u.rangeCount=="number",n.features.selectionHasRangeCount=ht,tt=!1,ct=!0,f.areHostMethods(u,["addRange","getRangeAt","removeAllRanges"])&&typeof u.rangeCount=="number"&&n.features.implementsDomRange&&function(){var f=document.createElement("iframe"),i,u;p.appendChild(f),i=r.getIframeDocument(f),i.open(),i.write("<html><head><\/head><body>12<\/body><\/html>"),i.close();var t=r.getIframeWindow(f).getSelection(),o=i.documentElement,s=o.lastChild,e=s.firstChild,n=i.createRange();n.setStart(e,1),n.collapse(!0),t.addRange(n),ct=t.rangeCount==1,t.removeAllRanges(),u=n.cloneRange(),n.setStart(e,0),u.setEnd(e,2),t.addRange(n),t.addRange(u),tt=t.rangeCount==2,n.detach(),u.detach(),p.removeChild(f)}(),n.features.selectionSupportsMultipleRanges=tt,n.features.collapsedNonEditableSelectionsSupported=ct,e=!1,p&&f.isHostMethod(p,"createControlRange")&&(dt=p.createControlRange(),f.areHostProperties(dt,["item","add"])&&(e=!0)),n.features.implementsControlRange=e,b=h?function(n){return n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset}:function(n){return n.rangeCount?n.getRangeAt(n.rangeCount-1).collapsed:!1},f.isHostMethod(u,"getRangeAt")?rt=function(n,t){try{return n.getRangeAt(t)}catch(i){return null}}:h&&(rt=function(t){var u=r.getDocument(t.anchorNode),i=n.createRange(u);return i.setStart(t.anchorNode,t.anchorOffset),i.setEnd(t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&(i.setStart(t.focusNode,t.focusOffset),i.setEnd(t.anchorNode,t.anchorOffset)),i}),n.getSelection=function(n){n=n||window;var t=n[lt],r=w(n),i=l?vt(n):null;return t?(t.nativeSelection=r,t.docSelection=i,t.refresh(n)):(t=new it(r,i,n),n[lt]=t),t},n.getIframeSelection=function(t){return n.getSelection(r.getIframeWindow(t))},i=it.prototype,!a&&h&&f.areHostMethods(u,["removeAllRanges","addRange"]))i.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)},st=function(t,i){var u=c.getRangeDocument(i),r=n.createRange(u);r.collapseToPoint(i.endContainer,i.endOffset),t.nativeSelection.addRange(et(r)),t.nativeSelection.extend(i.startContainer,i.startOffset),t.refresh()},i.addRange=ht?function(t,i){var u,r;e&&l&&this.docSelection.type==o?ti(this,t):i&&ut?st(this,t):(tt?u=this.rangeCount:(this.removeAllRanges(),u=0),this.nativeSelection.addRange(et(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==u+1?(n.config.checkSelectionRanges&&(r=rt(this.nativeSelection,this.rangeCount-1),r&&!c.rangesEqual(r,t)&&(t=new g(r))),this._ranges[this.rangeCount-1]=t,v(this,t,k(this.nativeSelection)),this.isCollapsed=b(this)):this.refresh())}:function(n,t){t&&ut?st(this,n):(this.nativeSelection.addRange(et(n)),this.refresh())},i.setRanges=function(n){if(e&&n.length>1)yt(this,n);else{this.removeAllRanges();for(var t=0,i=n.length;t<i;++t)this.addRange(n[t])}};else if(f.isHostMethod(u,"empty")&&f.isHostMethod(gt,"select")&&e&&a)i.removeAllRanges=function(){var n,t,i;try{this.docSelection.empty(),this.docSelection.type!="None"&&(this.anchorNode?n=r.getDocument(this.anchorNode):this.docSelection.type==o&&(t=this.docSelection.createRange(),t.length&&(n=r.getDocument(t.item(0)).body.createTextRange())),n&&(i=n.body.createTextRange(),i.select(),this.docSelection.empty()))}catch(u){}s(this)},i.addRange=function(n){this.docSelection.type==o?ti(this,n):(g.rangeToTextRange(n).select(),this._ranges[0]=n,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,v(this,n,!1))},i.setRanges=function(n){this.removeAllRanges();var t=n.length;t>1?yt(this,n):t&&this.addRange(n[0])};else return t.fail("No means of selecting a Range or TextRange was found"),!1;if(i.getRangeAt=function(n){if(n<0||n>=this.rangeCount)throw new nt("INDEX_SIZE_ERR");else return this._ranges[n]},a)d=function(t){var i;n.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=r.getBody(t.win.document).createTextRange(),i.collapse(!0)),t.docSelection.type==o?y(t):kt(i)?ii(t,i):s(t)};else if(f.isHostMethod(u,"getRangeAt")&&typeof u.rangeCount=="number")d=function(t){if(e&&l&&t.docSelection.type==o)y(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,r=t.rangeCount;i<r;++i)t._ranges[i]=new n.WrappedRange(t.nativeSelection.getRangeAt(i));v(t,t._ranges[t.rangeCount-1],k(t.nativeSelection)),t.isCollapsed=b(t)}else s(t)};else if(h&&typeof u.isCollapsed==wt&&typeof gt.collapsed==wt&&n.features.implementsDomRange)d=function(n){var i,t=n.nativeSelection;t.anchorNode?(i=rt(t,0),n._ranges=[i],n.rangeCount=1,ri(n),n.isCollapsed=b(n)):s(n)};else return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;i.refresh=function(n){var i=n?this._ranges.slice(0):null,t;if(d(this),n){if(t=i.length,t!=this._ranges.length)return!1;while(t--)if(!c.rangesEqual(i[t],this._ranges[t]))return!1;return!0}},ft=function(n,t){var r=n.getAllRanges(),f=!1,i,u;for(n.removeAllRanges(),i=0,u=r.length;i<u;++i)f||t!==r[i]?n.addRange(r[i]):f=!0;n.rangeCount||s(n)},i.removeRange=e?function(n){var t,f;if(this.docSelection.type==o){var i=this.docSelection.createRange(),h=ot(n),c=r.getDocument(i.item(0)),s=r.getBody(c).createControlRange(),e,u=!1;for(t=0,f=i.length;t<f;++t)e=i.item(t),e!==h||u?s.add(i.item(t)):u=!0;s.select(),y(this)}else ft(this,n)}:function(n){ft(this,n)},!a&&h&&n.features.implementsDomRange?(k=function(n){var t=!1;return n.anchorNode&&(t=r.comparePoints(n.anchorNode,n.anchorOffset,n.focusNode,n.focusOffset)==1),t},i.isBackwards=function(){return k(this)}):k=i.isBackwards=function(){return!1},i.toString=function(){for(var i=[],n=0,t=this.rangeCount;n<t;++n)i[n]=""+this._ranges[n];return i.join("")},i.collapse=function(t,i){pt(this,t);var u=n.createRange(r.getDocument(t));u.collapseToPoint(t,i),this.removeAllRanges(),this.addRange(u),this.isCollapsed=!0},i.collapseToStart=function(){if(this.rangeCount){var n=this._ranges[0];this.collapse(n.startContainer,n.startOffset)}else throw new nt("INVALID_STATE_ERR");},i.collapseToEnd=function(){if(this.rangeCount){var n=this._ranges[this.rangeCount-1];this.collapse(n.endContainer,n.endOffset)}else throw new nt("INVALID_STATE_ERR");},i.selectAllChildren=function(t){pt(this,t);var i=n.createRange(r.getDocument(t));i.selectNodeContents(t),this.removeAllRanges(),this.addRange(i)},i.deleteFromDocument=function(){var i,r,n,t,u;if(e&&l&&this.docSelection.type==o){for(i=this.docSelection.createRange();i.length;)r=i.item(0),i.remove(r),r.parentNode.removeChild(r);this.refresh()}else if(this.rangeCount){for(n=this.getAllRanges(),this.removeAllRanges(),t=0,u=n.length;t<u;++t)n[t].deleteContents();this.addRange(n[u-1])}},i.getAllRanges=function(){return this._ranges.slice(0)},i.setSingleRange=function(n){this.setRanges([n])},i.containsNode=function(n,t){for(var i=0,r=this._ranges.length;i<r;++i)if(this._ranges[i].containsNode(n,t))return!0;return!1},i.toHtml=function(){var r="",t,n,i;if(this.rangeCount){for(t=c.getRangeDocument(this._ranges[0]).createElement("div"),n=0,i=this._ranges.length;n<i;++n)t.appendChild(this._ranges[n].cloneContents());r=t.innerHTML}return r},i.getName=function(){return"WrappedSelection"},i.inspect=function(){return ni(this)},i.detach=function(){this.win[lt]=null,this.win=this.anchorNode=this.focusNode=null},it.inspect=ni,n.Selection=it,n.selectionPrototype=i,n.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return n.getSelection(this)}),t=null})}),Base=function(){},Base.extend=function(n,t){var u=Base.prototype.extend,r,f,i;return Base._prototyping=!0,r=new this,u.call(r,n),r.base=function(){},delete Base._prototyping,f=r.constructor,i=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(arguments[0]!=null)return(arguments[0].extend||u).call(arguments[0],r)},i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=r,i.toString=this.toString,i.valueOf=function(n){return n=="object"?i:f.valueOf()},u.call(i,t),typeof i.init=="function"&&i.init(),i},Base.prototype={extend:function(n,t){var r,f,u,i;if(arguments.length>1)r=this[n],r&&typeof t=="function"&&(!r.valueOf||r.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)&&(f=t.valueOf(),t=function(){var t=this.base||Base.prototype.base,n;return this.base=r,n=f.apply(this,arguments),this.base=t,n},t.valueOf=function(n){return n=="object"?t:f},t.toString=Base.toString),this[n]=t;else if(n){u=Base.prototype.extend,Base._prototyping||typeof this=="function"||(u=this.extend||u);for(var e={toSource:null},o=["constructor","toString","valueOf"],s=Base._prototyping?0:1;i=o[s++];)n[i]!=e[i]&&u.call(this,i,n[i]);for(i in n)e[i]||u.call(this,i,n[i])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(n,t,i){for(var r in n)this.prototype[r]===undefined&&t.call(i,n[r],r,n)},implement:function(){for(var n=0;n<arguments.length;n++)typeof arguments[n]=="function"?arguments[n](this.prototype):this.prototype.extend(arguments[n]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function e(n){return(/ipad|iphone|ipod/.test(n)&&n.match(/ os (\d+).+? like mac os x/)||[,0])[1]}var t=navigator.userAgent,f=document.createElement("div"),n=t.indexOf("MSIE")!==-1&&t.indexOf("Opera")===-1,i=t.indexOf("Gecko")!==-1&&t.indexOf("KHTML")===-1,u=t.indexOf("AppleWebKit/")!==-1,o=t.indexOf("Chrome/")!==-1,r=t.indexOf("Opera/")!==-1;return{USER_AGENT:t,supported:function(){var n=this.USER_AGENT.toLowerCase(),r="contentEditable"in f,u=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,t=document.querySelector&&document.querySelectorAll,i=this.isIos()&&e(n)<5||n.indexOf("opera mobi")!==-1||n.indexOf("hpwos/")!==-1;return r&&u&&t&&!i},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var n=this.USER_AGENT.toLowerCase();return n.indexOf("webkit")!==-1&&n.indexOf("mobile")!==-1},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!i},hasCurrentStyleProperty:function(){return"currentStyle"in f},insertsLineBreaksOnReturn:function(){return i},supportsPlaceholderAttributeOn:function(n){return"placeholder"in n},supportsEvent:function(n){return"on"+n in f||function(){return f.setAttribute("on"+n,"return;"),typeof f["on"+n]=="function"}()},supportsEventsInIframeCorrectly:function(){return!r},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return u||i},supportsDataTransfer:function(){try{return u&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(n){return!1}},supportsHTML5Tags:function(n){var i=n.createElement("div"),t="<article>foo<\/article>";return i.innerHTML=t,i.innerHTML.toLowerCase()===t},supportsCommand:function(){var f={formatBlock:n,insertUnorderedList:n||r||u,insertOrderedList:n||r||u},t={insertHTML:i};return function(n,i){var r=f[i];if(!r){try{return n.queryCommandSupported(i)}catch(e){}try{return n.queryCommandEnabled(i)}catch(u){return!!t[i]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return i||r||u},supportsGetAttributeCorrectly:function(){var n=document.createElement("td");return n.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return i||n||r},clearsListsInContentEditableCorrectly:function(){return i||n||u},autoScrollsToCaret:function(){return!u},autoClosesUnclosedTags:function(){var i=f.cloneNode(!1),t,n;return i.innerHTML="<p><div><\/div>",n=i.innerHTML.toLowerCase(),t=n==="<p><\/p><div><\/div>"||n==="<p><div><\/div><\/p>",this.autoClosesUnclosedTags=function(){return t},t},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in f},needsSpaceAfterLineBreak:function(){return r},supportsSpeechApiOn:function(n){var i=t.match(/Chrome\/(\d+)/)||[,0];return i[1]>=11&&("onwebkitspeechchange"in n||"speech"in n)},crashesWhenDefineProperty:function(t){return n&&(t==="XMLHttpRequest"||t==="XDomainRequest")},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return i||o||r}}}(),wysihtml5.lang.array=function(n){return{contains:function(t){if(n.indexOf)return n.indexOf(t)!==-1;for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return!0;return!1},without:function(t){t=wysihtml5.lang.array(t);for(var r=[],i=0,u=n.length;i<u;i++)t.contains(n[i])||r.push(n[i]);return r},get:function(){for(var t=0,r=n.length,i=[];t<r;t++)i.push(n[t]);return i}}},wysihtml5.lang.Dispatcher=Base.extend({observe:function(n,t){return this.events=this.events||{},this.events[n]=this.events[n]||[],this.events[n].push(t),this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(n,t){this.events=this.events||{};for(var r=this.events[n]||[],i=0;i<r.length;i++)r[i].call(this,t);return this},stopObserving:function(n,t){this.events=this.events||{};var r=0,i,u;if(n){for(i=this.events[n]||[],u=[];r<i.length;r++)i[r]!==t&&t&&u.push(i[r]);this.events[n]=u}else this.events={};return this}}),wysihtml5.lang.object=function(n){return{merge:function(t){for(var i in t)n[i]=t[i];return this},get:function(){return n},clone:function(){var i={},t;for(t in n)i[t]=n[t];return i},isArray:function(){return Object.prototype.toString.call(n)==="[object Array]"}}},function(){var t=/^\s+/,n=/\s+$/;wysihtml5.lang.string=function(i){return i=String(i),{trim:function(){return i.replace(t,"").replace(n,"")},interpolate:function(n){for(var t in n)i=this.replace("#{"+t+"}").by(n[t]);return i},replace:function(n){return{by:function(t){return i.split(n).join(t)}}}}}}(),function(n){function h(n){return o(n)?n:(n===n.ownerDocument.documentElement&&(n=n.ownerDocument.body),r(n))}function c(n){return n.replace(t,function(n,t){var u=(t.match(f)||[])[1]||"",o=s[u],r,e;return t=t.replace(f,""),t.split(o).length>t.split(u).length&&(t=t+u,u=""),r=t,e=t,t.length>i&&(e=e.substr(0,i)+"..."),r.substr(0,4)==="www."&&(r="http://"+r),'<a href="'+r+'">'+e+"<\/a>"+u})}function l(n){var t=n._wysihtml5_tempElement;return t||(t=n._wysihtml5_tempElement=n.createElement("div")),t}function e(n){var i=n.parentNode,t=l(i.ownerDocument);for(t.innerHTML="<span><\/span>"+c(n.data),t.removeChild(t.firstChild);t.firstChild;)i.insertBefore(t.firstChild,n);i.removeChild(n)}function o(n){for(var t;n.parentNode;){if(n=n.parentNode,t=n.nodeName,u.contains(t))return!0;if(t==="body")return!1}return!1}function r(i){if(!u.contains(i.nodeName)){if(i.nodeType===n.TEXT_NODE&&i.data.match(t)){e(i);return}for(var o=n.lang.array(i.childNodes).get(),s=o.length,f=0;f<s;f++)r(o[f]);return i}}var u=n.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),t=/((https?:\/\/|www\.)[^\s<]{3,})/gi,f=/([^\w\/\-](,?))$/i,i=100,s={")":"(","]":"[","}":"{"};n.dom.autoLink=h,n.dom.autoLink.URL_REG_EXP=t}(wysihtml5),function(n){var i=n.browser.supportsClassList(),t=n.dom;t.addClass=function(n,r){if(i)return n.classList.add(r);t.hasClass(n,r)||(n.className+=" "+r)},t.removeClass=function(n,t){if(i)return n.classList.remove(t);n.className=n.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")},t.hasClass=function(n,t){if(i)return n.classList.contains(t);var r=n.className;return r.length>0&&(r==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(r))}}(wysihtml5),wysihtml5.dom.contains=function(){var n=document.documentElement;return n.contains?function(n,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),n!==t&&n.contains(t)}:n.compareDocumentPosition?function(n,t){return!!(n.compareDocumentPosition(t)&16)}:void 0}(),wysihtml5.dom.convertToList=function(){function n(n,t){var i=n.createElement("li");return t.appendChild(i),i}function i(n,t){return n.createElement(t)}function t(t,r){if(t.nodeName==="UL"||t.nodeName==="OL"||t.nodeName==="MENU")return t;for(var c=t.ownerDocument,h=i(c,r),y=t.querySelectorAll("br"),w=y.length,l,v,o,e,s,p,a,u,f=0;f<w;f++)for(e=y[f];(s=e.parentNode)&&s!==t&&s.lastChild===e;){if(wysihtml5.dom.getStyle("display").from(s)==="block"){s.removeChild(e);break}wysihtml5.dom.insert(e).after(e.parentNode)}for(l=wysihtml5.lang.array(t.childNodes).get(),v=l.length,f=0;f<v;f++){if(u=u||n(c,h),o=l[f],p=wysihtml5.dom.getStyle("display").from(o)==="block",a=o.nodeName==="BR",p){u=u.firstChild?n(c,h):u,u.appendChild(o),u=null;continue}if(a){u=u.firstChild?null:u;continue}u.appendChild(o)}return t.parentNode.replaceChild(h,t),h}return t}(),wysihtml5.dom.copyAttributes=function(n){return{from:function(t){return{to:function(i){for(var r,u=0,f=n.length;u<f;u++)r=n[u],typeof t[r]!="undefined"&&t[r]!==""&&(i[r]=t[r]);return{andTo:arguments.callee}}}}}},function(n){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],r=function(t){return i(t)?parseInt(n.getStyle("width").from(t),10)<t.offsetWidth:!1},i=function(i){for(var r=0,u=t.length;r<u;r++)if(n.getStyle(t[r]).from(i)==="border-box")return t[r]};n.copyStyles=function(i){return{from:function(u){r(u)&&(i=wysihtml5.lang.array(i).without(t));for(var o="",s=i.length,f=0,e;f<s;f++)e=i[f],o+=e+":"+n.getStyle(e).from(u)+";";return{to:function(t){n.setStyles(o).on(t);return{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(n){n.dom.delegate=function(t,i,r,u){return n.dom.observe(t,r,function(r){for(var f=r.target,e=n.lang.array(t.querySelectorAll(i));f&&f!==t;){if(e.contains(f)){u.call(f,r);break}f=f.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var t=function(n,t){var i=t.createElement("div");i.style.display="none",t.body.appendChild(i);try{i.innerHTML=n}catch(r){}return t.body.removeChild(i),i},i=function(t){if(!t._wysihtml5_supportsHTML5Tags){for(var i=0,r=n.length;i<r;i++)t.createElement(n[i]);t._wysihtml5_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,r){r=r||document;var u;return typeof n=="object"&&n.nodeType?(u=r.createElement("div"),u.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(r)?(u=r.createElement("div"),u.innerHTML=n):(i(r),u=t(n,r)),u}}(),wysihtml5.dom.getParentElement=function(){function n(n,t){return!t||!t.length?!0:typeof t=="string"?n===t:wysihtml5.lang.array(t).contains(n)}function r(n){return n.nodeType===wysihtml5.ELEMENT_NODE}function u(n,t,i){var r=(n.className||"").match(i)||[];return t?r[r.length-1]===t:!!r.length}function t(t,i,r){while(r--&&t&&t.nodeName!=="BODY"){if(n(t.nodeName,i))return t;t=t.parentNode}return null}function i(t,i,f,e,o){while(o--&&t&&t.nodeName!=="BODY"){if(r(t)&&n(t.nodeName,i)&&u(t,f,e))return t;t=t.parentNode}return null}return function(n,r,u){return u=u||50,r.className||r.classRegExp?i(n,r.nodeName,r.className,r.classRegExp,u):t(n,r.nodeName,u)}}(),wysihtml5.dom.getStyle=function(){function n(n){return n.replace(t,function(n){return n.charAt(1).toUpperCase()})}var i={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},t=/\-[a-z]/g;return function(t){return{from:function(r){var e,f,o,s;if(r.nodeType===wysihtml5.ELEMENT_NODE){var c=r.ownerDocument,h=i[t]||n(t),u=r.style,a=r.currentStyle,l=u[h];if(l)return l;if(a)try{return a[h]}catch(v){}return e=c.defaultView||c.parentWindow,f=(t==="height"||t==="width")&&r.nodeName==="TEXTAREA",e.getComputedStyle?(f&&(o=u.overflow,u.overflow="hidden"),s=e.getComputedStyle(r,null).getPropertyValue(t),f&&(u.overflow=o||""),s):void 0}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){function t(n){return n._wysihtml5_identifier||(n._wysihtml5_identifier=i++)}var n={},i=1;return function(i,r){var f=t(i)+":"+r,u=n[f];return u||(u=n[f]=i.getElementsByTagName(r)),u.length>0}}(),function(n){function i(n){return n._wysihtml5_identifier||(n._wysihtml5_identifier=r++)}var t={},r=1;n.dom.hasElementWithClassName=function(r,u){if(!n.browser.supportsNativeGetElementsByClassName())return!!r.querySelector("."+u);var e=i(r)+":"+u,f=t[e];return f||(f=t[e]=r.getElementsByClassName(u)),f.length>0}}(wysihtml5),wysihtml5.dom.insert=function(n){return{after:function(t){t.parentNode.insertBefore(n,t.nextSibling)},before:function(t){t.parentNode.insertBefore(n,t)},into:function(t){t.appendChild(n)}}},wysihtml5.dom.insertCSS=function(n){return n=n.join("\n"),{into:function(t){var r=t.head||t.getElementsByTagName("head")[0],i=t.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=n:i.appendChild(t.createTextNode(n)),r&&r.appendChild(i)}}},wysihtml5.dom.observe=function(n,t,i){t=typeof t=="string"?[t]:t;for(var f,u,r=0,e=t.length;r<e;r++)u=t[r],n.addEventListener?n.addEventListener(u,i,!1):(f=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},i.call(n,t)},n.attachEvent("on"+u,f));return{stop:function(){for(var u,r=0,e=t.length;r<e;r++)u=t[r],n.removeEventListener?n.removeEventListener(u,i,!1):n.detachEvent("on"+u,f)}}},wysihtml5.dom.parse=function(){function y(t,r,u,f){wysihtml5.lang.object(n).merge(h).merge(r).get(),u=u||t.ownerDocument||document;for(var c=u.createDocumentFragment(),l=typeof t=="string",o,s,e=l?wysihtml5.dom.getAsDom(t,u):t;e.firstChild;)s=e.firstChild,e.removeChild(s),o=i(s,f),o&&c.appendChild(o);return e.innerHTML="",e.appendChild(c),l?wysihtml5.quirks.getCorrectInnerHTML(e):e}function i(n,t){var h=n.nodeType,o=n.childNodes,s=o.length,u,e=l[h],f=0;if(u=e&&e(n),!u)return null;for(f=0;f<s;f++)newChild=i(o[f],t),newChild&&u.appendChild(newChild);return t&&u.childNodes.length<=1&&u.nodeName.toLowerCase()===r&&!u.attributes.length?u.firstChild:u}function v(t){var i,e,s,o=n.tags,u=t.nodeName.toLowerCase(),f=t.scopeName;if(t._wysihtml5||(t._wysihtml5=1,t.className==="wysihtml5-temp"))return null;if(f&&f!="HTML"&&(u=f+":"+u),"outerHTML"in t&&(wysihtml5.browser.autoClosesUnclosedTags()||t.nodeName!=="P"||t.outerHTML.slice(-4).toLowerCase()==="<\/p>"||(u="div")),u in o){if(i=o[u],!i||i.remove)return null;i=typeof i=="string"?{rename_tag:i}:i}else if(t.firstChild)i={rename_tag:r};else return null;return e=t.ownerDocument.createElement(i.rename_tag||u),a(t,e,i),t=null,e}function a(i,r,u){var o={},tt=u.set_class,w=u.add_class,ut=u.set_attributes,k=u.check_attributes,it=n.classes,d=0,h=[],nt=[],v=[],p=[],rt,b,l,g,f,y,a;if(ut&&(o=wysihtml5.lang.object(ut).clone()),k)for(f in k)(a=e[k[f]],a)&&(y=a(t(i,f)),typeof y=="string"&&(o[f]=y));if(tt&&h.push(tt),w)for(f in w)(a=s[w[f]],a)&&(g=a(t(i,f)),typeof g=="string"&&h.push(g));for(it["_wysihtml5-temp-placeholder"]=1,p=i.getAttribute("class"),p&&(h=h.concat(p.split(c))),rt=h.length;d<rt;d++)l=h[d],it[l]&&nt.push(l);for(b=nt.length;b--;)l=nt[b],wysihtml5.lang.array(v).contains(l)||v.unshift(l);v.length&&(o["class"]=v.join(" "));for(f in o)try{r.setAttribute(f,o[f])}catch(ft){}o.src&&(typeof o.width!="undefined"&&r.setAttribute("width",o.width),typeof o.height!="undefined"&&r.setAttribute("height",o.height))}function t(n,t){var e,r,i;return t=t.toLowerCase(),e=n.nodeName,e=="IMG"&&t=="src"&&f(n)===!0?n.src:u&&"outerHTML"in n?(r=n.outerHTML.toLowerCase(),i=r.indexOf(" "+t+"=")!=-1,i?n.getAttribute(t):null):n.getAttribute(t)}function f(n){try{return n.complete&&!n.mozMatchesSelector(":-moz-broken")}catch(t){if(n.complete&&n.readyState==="complete")return!0}}function o(n){return n.ownerDocument.createTextNode(n.data)}var l={"1":v,"3":o},r="span",c=/\s+/,h={tags:{},classes:{}},n={},u=!wysihtml5.browser.supportsGetAttributeCorrectly(),e={url:function(){var n=/^https?:\/\//i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),alt:function(){var n=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(n,""):""}}(),numbers:function(){var n=/\D/g;return function(t){return t=(t||"").replace(n,""),t||null}}()},s={align_img:function(){var n={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return n[String(t).toLowerCase()]}}(),align_text:function(){var n={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return n[String(t).toLowerCase()]}}(),clear_br:function(){var n={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return n[String(t).toLowerCase()]}}(),size_font:function(){var n={"1":"wysiwyg-font-size-xx-small","2":"wysiwyg-font-size-small","3":"wysiwyg-font-size-medium","4":"wysiwyg-font-size-large","5":"wysiwyg-font-size-x-large","6":"wysiwyg-font-size-xx-large","7":"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return n[String(t).charAt(0)]}}()};return y}(),wysihtml5.dom.removeEmptyTextNodes=function(n){for(var t,r=wysihtml5.lang.array(n.childNodes).get(),u=r.length,i=0;i<u;i++)t=r[i],t.nodeType===wysihtml5.TEXT_NODE&&t.data===""&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(n,t){for(var i=n.ownerDocument.createElement(t),r;r=n.firstChild;)i.appendChild(r);return wysihtml5.dom.copyAttributes(["align","className"]).from(n).to(i),n.parentNode.replaceChild(i,n),i},wysihtml5.dom.replaceWithChildNodes=function(n){if(n.parentNode){if(!n.firstChild){n.parentNode.removeChild(n);return}for(var t=n.ownerDocument.createDocumentFragment();n.firstChild;)t.appendChild(n.firstChild);n.parentNode.replaceChild(t,n),n=t=null}},function(n){function i(t){return n.getStyle("display").from(t)==="block"}function u(n){return n.nodeName==="BR"}function t(n){var t=n.ownerDocument.createElement("br");n.appendChild(t)}function r(n){if(n.nodeName==="MENU"||n.nodeName==="UL"||n.nodeName==="OL"){var l=n.ownerDocument,e=l.createDocumentFragment(),h=n.previousElementSibling||n.previousSibling,r,c,o,s,f;for(h&&!i(h)&&t(e);f=n.firstChild;){for(c=f.lastChild;r=f.firstChild;)o=r===c,s=o&&!i(r)&&!u(r),e.appendChild(r),s&&t(e);f.parentNode.removeChild(f)}n.parentNode.replaceChild(e,n)}}n.resolveList=r}(wysihtml5.dom),function(n){var t=document,u=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],r=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],i=["referrer","write","open","close"];n.dom.Sandbox=Base.extend({constructor:function(t,i){this.callback=t||n.EMPTY_FUNCTION,this.config=n.lang.object({}).merge(i).get(),this.iframe=this._createIframe()},insertInto:function(n){typeof n=="string"&&(n=t.getElementById(n)),n.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var n=this.getIframe();n.parentNode.removeChild(n)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var r=this,i=t.createElement("iframe");i.className="wysihtml5-sandbox";n.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(i);return n.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(i.src="javascript:'<html><\/html>'"),i.onload=function(){i.onreadystatechange=i.onload=null,r._onLoadIframe(i)},i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=i.onload=null,r._onLoadIframe(i))},i},_onLoadIframe:function(f){var e,o;if(n.dom.contains(t.documentElement,f)){var c=this,h=f.contentWindow,s=f.contentWindow.document,a=t.characterSet||t.charset||"utf-8",l=this._getHtml({charset:a,stylesheets:this.config.stylesheets});if(s.open("text/html","replace"),s.write(l),s.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(n,t,i){throw new Error("wysihtml5.Sandbox: "+n,t,i);},!n.browser.supportsSandboxedIframes()){for(e=0,o=u.length;e<o;e++)this._unset(h,u[e]);for(e=0,o=r.length;e<o;e++)this._unset(h,r[e],n.EMPTY_FUNCTION);for(e=0,o=i.length;e<o;e++)this._unset(s,i[e]);this._unset(s,"cookie","",!0)}this.loaded=!0,setTimeout(function(){c.callback(c)},0)}},_getHtml:function(t){var i=t.stylesheets,f="",r=0,u;if(i=typeof i=="string"?[i]:i,i)for(u=i.length;r<u;r++)f+='<link rel="stylesheet" href="'+i[r]+'">';return t.stylesheets=f,n.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}<\/head><body><\/body><\/html>').interpolate(t)},_unset:function(t,i,r,u){try{t[i]=r}catch(e){}try{t.__defineGetter__(i,function(){return r})}catch(e){}if(u)try{t.__defineSetter__(i,function(){})}catch(e){}if(!n.browser.crashesWhenDefineProperty(i))try{var f={get:function(){return r}};u&&(f.set=function(){}),Object.defineProperty(t,i,f)}catch(e){}}})}(wysihtml5),function(){var n={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(i){for(var r in t)i.setAttribute(n[r]||r,t[r])}}}}(),wysihtml5.dom.setStyles=function(n){return{on:function(t){var r=t.style,i;if(typeof n=="string"){r.cssText+=";"+n;return}for(i in n)i==="float"?(r.cssFloat=n[i],r.styleFloat=n[i]):r[i]=n[i]}}},function(n){n.simulatePlaceholder=function(t,i,r){var e="placeholder",f=function(){i.hasPlaceholderSet()&&i.clear(),n.removeClass(i.element,e)},u=function(){i.isEmpty()&&(i.setValue(r),n.addClass(i.element,e))};t.observe("set_placeholder",u).observe("unset_placeholder",f).observe("focus:composer",f).observe("paste:composer",f).observe("blur:composer",u),u()}}(wysihtml5.dom),function(n){var t=document.documentElement;"textContent"in t?(n.setTextContent=function(n,t){n.textContent=t},n.getTextContent=function(n){return n.textContent}):"innerText"in t?(n.setTextContent=function(n,t){n.innerText=t},n.getTextContent=function(n){return n.innerText}):(n.setTextContent=function(n,t){n.nodeValue=t},n.getTextContent=function(n){return n.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){function n(n,i,r){i=i||t,r=r||n.ownerDocument||document;var u,s=typeof n=="string",h,f,c,e,o=0;u=s?wysihtml5.dom.getAsDom(n,r):n;for(e in i)for(f=u.querySelectorAll(e),h=i[e],c=f.length;o<c;o++)h(f[o]);return f=n=i=null,s?u.innerHTML:u}var t={"a u":wysihtml5.dom.replaceWithChildNodes};return n}(),function(n){var t=n.dom;n.quirks.ensureProperClearing=function(){var n=function(){var t=this;setTimeout(function(){var n=t.innerHTML.toLowerCase();(n=="<p>&nbsp;<\/p>"||n=="<p>&nbsp;<\/p><p>&nbsp;<\/p>")&&(t.innerHTML="")},0)};return function(i){t.observe(i.element,["cut","keydown"],n)}}(),n.quirks.ensureProperClearingOfLists=function(){var i=["OL","UL","MENU"],r=function(r,u){var f,s,o,e;u.firstChild&&n.lang.array(i).contains(u.firstChild.nodeName)&&(f=t.getParentElement(r,{nodeName:i}),f)&&(s=f==u.firstChild,s)&&(o=f.childNodes.length<=1,o)&&(e=f.firstChild?f.firstChild.innerHTML==="":!0,e)&&f.parentNode.removeChild(f)};return function(i){t.observe(i.element,"keydown",function(t){if(t.keyCode===n.BACKSPACE_KEY){var u=i.selection.getSelectedNode();r(u,i.element)}})}}()}(wysihtml5),function(n){var t="%7E";n.quirks.getCorrectInnerHTML=function(i){var u=i.innerHTML,f,e,o,s,r;if(u.indexOf(t)===-1)return u;for(f=i.querySelectorAll("[href*='~'], [src*='~']"),r=0,s=f.length;r<s;r++)e=f[r].href||f[r].src,o=n.lang.string(e).replace("~").by(t),u=n.lang.string(u).replace(o).by(e);return u}}(wysihtml5),function(n){var t=n.dom,r=["LI","P","H1","H2","H3","H4","H5","H6"],i=["UL","OL","MENU"];n.quirks.insertLineBreakOnReturn=function(u){function f(i){var f=t.getParentElement(i,{nodeName:["P","DIV"]},2),r;f&&(r=document.createTextNode(n.INVISIBLE_SPACE),t.insert(r).before(f),t.replaceWithChildNodes(f),u.selection.selectNode(r))}function e(e){var o=e.keyCode;if(!e.shiftKey&&(o===n.ENTER_KEY||o===n.BACKSPACE_KEY)){var c=e.target,h=u.selection.getSelectedNode(),s=t.getParentElement(h,{nodeName:r},4);if(s){s.nodeName==="LI"&&(o===n.ENTER_KEY||o===n.BACKSPACE_KEY)?setTimeout(function(){var n=u.selection.getSelectedNode(),r,e;n&&((r=t.getParentElement(n,{nodeName:i},2),r)||f(n))},0):s.nodeName.match(/H[1-6]/)&&o===n.ENTER_KEY&&setTimeout(function(){f(u.selection.getSelectedNode())},0);return}o!==n.ENTER_KEY||n.browser.insertsLineBreaksOnReturn()||(u.commands.exec("insertLineBreak"),e.preventDefault())}}t.observe(u.element.ownerDocument,"keydown",e)}}(wysihtml5),function(n){var t="wysihtml5-quirks-redraw";n.quirks.redraw=function(i){n.dom.addClass(i,t),n.dom.removeClass(i,t);try{var r=i.ownerDocument;r.execCommand("italic",!1,null),r.execCommand("italic",!1,null)}catch(u){}}}(wysihtml5),function(n){function t(n){var t=0;if(n.parentNode)do t+=n.offsetTop||0,n=n.offsetParent;while(n);return t}var i=n.dom;n.Selection=Base.extend({constructor:function(n){window.rangy.init(),this.editor=n,this.composer=n.composer,this.doc=this.composer.doc},getBookmark:function(){var n=this.getRange();return n&&n.cloneRange()},setBookmark:function(n){n&&this.setSelection(n)},setBefore:function(n){var t=rangy.createRange(this.doc);return t.setStartBefore(n),t.setEndBefore(n),this.setSelection(t)},setAfter:function(n){var t=rangy.createRange(this.doc);return t.setStartAfter(n),t.setEndAfter(n),this.setSelection(t)},selectNode:function(t){var r=rangy.createRange(this.doc),e=t.nodeType===n.ELEMENT_NODE,u="canHaveHTML"in t?t.canHaveHTML:t.nodeName!=="IMG",s=e?t.innerHTML:t.data,f=s===""||s===n.INVISIBLE_SPACE,o=i.getStyle("display").from(t),h=o==="block"||o==="list-item";if(f&&e&&u)try{t.innerHTML=n.INVISIBLE_SPACE}catch(c){}u?r.selectNodeContents(t):r.selectNode(t),u&&f&&e?r.collapse(h):u&&f&&(r.setStartAfter(t),r.setEndAfter(t)),this.setSelection(r)},getSelectedNode:function(n){var i,t;return n&&this.doc.selection&&this.doc.selection.type==="Control"&&(t=this.doc.selection.createRange(),t&&t.length)?t.item(0):(i=this.getSelection(this.doc),i.focusNode===i.anchorNode?i.focusNode:(t=this.getRange(this.doc),t?t.commonAncestorContainer:this.doc.body))},executeAndRestore:function(t,i){var r=this.doc.body,s=i&&r.scrollTop,h=i&&r.scrollLeft,o="_wysihtml5-temp-placeholder",c='<span class="'+o+'">'+n.INVISIBLE_SPACE+"<\/span>",u=this.getRange(this.doc),f,e;if(!u){t(r,r);return}e=u.createContextualFragment(c),u.insertNode(e);try{t(u.startContainer,u.endContainer)}catch(a){setTimeout(function(){throw a;},0)}caretPlaceholder=this.doc.querySelector("."+o),caretPlaceholder?(f=rangy.createRange(this.doc),f.selectNode(caretPlaceholder),f.deleteContents(),this.setSelection(f)):r.focus(),i&&(r.scrollTop=s,r.scrollLeft=h);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(l){}},executeAndRestoreSimple:function(n){var t=this.getRange(),o=this.doc.body,f,e,r,u,i;if(!t){n(o,o);return}u=t.getNodes([3]),e=u[0]||t.startContainer,r=u[u.length-1]||t.endContainer,i={collapsed:t.collapsed,startContainer:e,startOffset:e===t.startContainer?t.startOffset:0,endContainer:r,endOffset:r===t.endContainer?t.endOffset:r.length};try{n(t.startContainer,t.endContainer)}catch(c){setTimeout(function(){throw c;},0)}f=rangy.createRange(this.doc);try{f.setStart(i.startContainer,i.startOffset)}catch(l){}try{f.setEnd(i.endContainer,i.endOffset)}catch(s){}try{this.setSelection(f)}catch(h){}},insertHTML:function(n){var r=rangy.createRange(this.doc),t=r.createContextualFragment(n),i=t.lastChild;this.insertNode(t),i&&this.setAfter(i)},insertNode:function(n){var t=this.getRange();t&&t.insertNode(n)},surround:function(n){var t=this.getRange();if(t)try{t.surroundContents(n),this.selectNode(n)}catch(i){n.appendChild(t.extractContents()),t.insertNode(n)}},scrollIntoView:function(){var i=this.doc,f=i.documentElement.scrollHeight>i.documentElement.offsetHeight,r=i._wysihtml5ScrollIntoViewElement=i._wysihtml5ScrollIntoViewElement||function(){var t=i.createElement("span");return t.innerHTML=n.INVISIBLE_SPACE,t}(),u;f&&(this.insertNode(r),u=t(r),r.parentNode.removeChild(r),u>i.body.scrollTop&&(i.body.scrollTop=u))},selectLine:function(){n.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var t=this.doc.defaultView,n=t.getSelection();n.modify("extend","left","lineboundary"),n.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var n=this.doc.selection.createRange(),i=n.boundingTop,c=n.boundingHeight,e=this.doc.body.scrollWidth,o,f,t,u,r;if(n.moveToPoint){for(i===0&&(t=this.doc.createElement("span"),this.insertNode(t),i=t.offsetTop,t.parentNode.removeChild(t)),i+=1,u=-10;u<e;u+=2)try{n.moveToPoint(u,i);break}catch(h){}for(o=i,f=this.doc.selection.createRange(),r=e;r>=0;r--)try{f.moveToPoint(r,o);break}catch(s){}n.setEndPoint("EndToEnd",f),n.select()}},getText:function(){var n=this.getSelection();return n?n.toString():""},getNodes:function(n,t){var i=this.getRange();return i?i.getNodes([n],t):[]},getRange:function(){var n=this.getSelection();return n&&n.rangeCount&&n.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(n){var i=this.doc.defaultView||this.doc.parentWindow,t=rangy.getSelection(i);return t.setSingleRange(n)}})}(wysihtml5),function(n,t){function s(n,t,i){if(!n.className)return!1;var r=n.className.match(i)||[];return r[r.length-1]===t}function c(n,t,i){n.className?(e(n,i),n.className+=" "+t):n.className=t}function e(n,t){n.className&&(n.className=n.className.replace(t,""))}function l(n,t){return n.className.replace(o," ")==t.className.replace(o," ")}function a(n){for(var t=n.parentNode;n.firstChild;)t.insertBefore(n.firstChild,n);t.removeChild(n)}function v(n,t){if(n.attributes.length!=t.attributes.length)return!1;for(var u=0,e=n.attributes.length,i,r,f;u<e;++u)if(i=n.attributes[u],f=i.name,f!="class"&&((r=t.attributes.getNamedItem(f),i.specified!=r.specified)||i.specified&&i.nodeValue!==r.nodeValue))return!1;return!0}function u(n,i){return t.dom.isCharacterDataNode(n)?i==0?!!n.previousSibling:i==n.length?!!n.nextSibling:!0:i>0&&i<n.childNodes.length}function r(n,i,u){var f,e;if(t.dom.isCharacterDataNode(i)&&(u==0?(u=t.dom.getNodeIndex(i),i=i.parentNode):u==i.length?(u=t.dom.getNodeIndex(i)+1,i=i.parentNode):f=t.dom.splitDataNode(i,u)),!f){for(f=i.cloneNode(!1),f.id&&f.removeAttribute("id");e=i.childNodes[u];)f.appendChild(e);t.dom.insertAfter(f,i)}return i==n?f:r(n,f.parentNode,t.dom.getNodeIndex(f))}function i(t){this.isElementMerge=t.nodeType==n.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function f(n,t,i,r){this.tagNames=n||[h],this.cssClass=t||"",this.similarClassRegExp=i,this.normalize=r,this.applyToAnyTagName=!1}var h="span",o=/\s+/g;i.prototype={doMerge:function(){for(var u=[],i,t,f,n=0,r=this.textNodes.length;n<r;++n)i=this.textNodes[n],t=i.parentNode,u[n]=i.data,n&&(t.removeChild(i),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=f=u.join(""),f},getLength:function(){for(var t=this.textNodes.length,n=0;t--;)n+=this.textNodes[t].length;return n},toString:function(){for(var i=[],n=0,t=this.textNodes.length;n<t;++n)i[n]="'"+this.textNodes[n].data+"'";return"[Merge("+i.join(",")+")]"}},f.prototype={getAncestorWithClass:function(i){for(var r;i;){if(r=this.cssClass?s(i,this.cssClass,this.similarClassRegExp):!0,i.nodeType==n.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&r)return i;i=i.parentNode}return!1},postApply:function(n,t){for(var v=n[0],e=n[n.length-1],o=[],r,c=v,a=e,y=0,p=e.length,f,h,l,u=0,s=n.length;u<s;++u)f=n[u],h=this.getAdjacentMergeableTextNode(f.parentNode,!1),h?(r||(r=new i(h),o.push(r)),r.textNodes.push(f),f===v&&(c=r.firstTextNode,y=c.length),f===e&&(a=r.firstTextNode,p=r.getLength())):r=null;if(l=this.getAdjacentMergeableTextNode(e.parentNode,!0),l&&(r||(r=new i(e),o.push(r)),r.textNodes.push(l)),o.length){for(u=0,s=o.length;u<s;++u)o[u].doMerge();t.setStart(c,y),t.setEnd(a,p)}},getAdjacentMergeableTextNode:function(t,i){var f=t.nodeType==n.TEXT_NODE,e=f?t.parentNode:t,r,u=i?"nextSibling":"previousSibling";if(f){if(r=t[u],r&&r.nodeType==n.TEXT_NODE)return r}else if(r=e[u],r&&this.areElementsMergeable(t,r))return r[i?"firstChild":"lastChild"];return null},areElementsMergeable:function(n,i){return t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())&&l(n,i)&&v(n,i)},createContainer:function(n){var t=n.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),t},applyToTextNode:function(n){var r=n.parentNode,i;r.childNodes.length==1&&t.dom.arrayContains(this.tagNames,r.tagName.toLowerCase())?this.cssClass&&c(r,this.cssClass,this.similarClassRegExp):(i=this.createContainer(t.dom.getDocument(n)),n.parentNode.insertBefore(i,n),i.appendChild(n))},isRemovable:function(i){return t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&n.lang.string(i.className).trim()==this.cssClass},undoToTextNode:function(n,t,i){if(!t.containsNode(i)){var f=t.cloneRange();f.selectNode(i),f.isPointInRange(t.endContainer,t.endOffset)&&u(t.endContainer,t.endOffset)&&(r(i,t.endContainer,t.endOffset),t.setEndAfter(i)),f.isPointInRange(t.startContainer,t.startOffset)&&u(t.startContainer,t.startOffset)&&(i=r(i,t.startContainer,t.startOffset))}this.similarClassRegExp&&e(i,this.similarClassRegExp),this.isRemovable(i)&&a(i)},applyToRange:function(t){var i=t.getNodes([n.TEXT_NODE]),f,r,u,e;if(!i.length)try{f=this.createContainer(t.endContainer.ownerDocument),t.surroundContents(f),this.selectNode(t,f);return}catch(o){}if(t.splitBoundaries(),i=t.getNodes([n.TEXT_NODE]),i.length){for(u=0,e=i.length;u<e;++u)r=i[u],this.getAncestorWithClass(r)||this.applyToTextNode(r);t.setStart(i[0],0),r=i[i.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(i,t)}},undoToRange:function(t){var i=t.getNodes([n.TEXT_NODE]),r,o,s,u,f,e;for(i.length?(t.splitBoundaries(),i=t.getNodes([n.TEXT_NODE])):(s=t.endContainer.ownerDocument,u=s.createTextNode(n.INVISIBLE_SPACE),t.insertNode(u),t.selectNode(u),i=[u]),f=0,e=i.length;f<e;++f)r=i[f],o=this.getAncestorWithClass(r),o&&this.undoToTextNode(r,t,o);e==1?this.selectNode(t,i[0]):(t.setStart(i[0],0),r=i[i.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(i,t))},selectNode:function(t,i){var u=i.nodeType===n.ELEMENT_NODE,e="canHaveHTML"in i?i.canHaveHTML:!0,f=u?i.innerHTML:i.data,r=f===""||f===n.INVISIBLE_SPACE;if(r&&u&&e)try{i.innerHTML=n.INVISIBLE_SPACE}catch(o){}t.selectNodeContents(i),r&&u?t.collapse(!1):r&&(t.setStartAfter(i),t.setEndAfter(i))},getTextSelectedByRange:function(n,t){var r=t.cloneRange(),i,u;return r.selectNodeContents(n),i=r.intersection(t),u=i?i.toString():"",r.detach(),u},isAppliedToRange:function(t){var o=[],i,u=t.getNodes([n.TEXT_NODE]),r,e,f;if(!u.length)return i=this.getAncestorWithClass(t.startContainer),i?[i]:!1;for(r=0,e=u.length;r<e;++r)if(f=this.getTextSelectedByRange(u[r],t),i=this.getAncestorWithClass(u[r]),f==""||i)o.push(i);else return!1;return o},toggleRange:function(n){this.isAppliedToRange(n)?this.undoToRange(n):this.applyToRange(n)}},n.selection.HTMLApplier=f}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(n){this.editor=n,this.composer=n.composer,this.doc=this.composer.doc},support:function(n){return wysihtml5.browser.supportsCommand(this.doc,n)},exec:function(n,t){var r=wysihtml5.commands[n],f=wysihtml5.lang.array(arguments).get(),u=r&&r.exec,i=null;if(this.editor.fire("beforecommand:composer"),u)f.unshift(this.composer),i=u.apply(r,f);else try{i=this.doc.execCommand(n,!1,t)}catch(e){}return this.editor.fire("aftercommand:composer"),i},state:function(n){var i=wysihtml5.commands[n],u=wysihtml5.lang.array(arguments).get(),r=i&&i.state;if(r)return u.unshift(this.composer),r.apply(i,u);try{return this.doc.queryCommandState(n)}catch(f){return!1}},value:function(n){var t=wysihtml5.commands[n],i=t&&t.value;if(i)return i.call(t,this.composer,n);try{return this.doc.queryCommandValue(n)}catch(r){return null}}}),function(n){var t;n.commands.bold={exec:function(t,i){return n.commands.formatInline.exec(t,i,"b")},state:function(t,i){return n.commands.formatInline.state(t,i,"b")},value:function(){return t}}}(wysihtml5),function(n){function f(n,i){for(var o=i.length,f=0,r,u,e;f<o;f++)r=i[f],u=t.getParentElement(r,{nodeName:"code"}),e=t.getTextContent(r),e.match(t.autoLink.URL_REG_EXP)&&!u?u=t.renameElement(r,"code"):t.replaceWithChildNodes(r)}function u(u,f){var p=u.doc,y="_wysihtml5-temp-"+ +new Date,k=/non-matching-class/g,a=0,v,l,e,b,w,o,c,s,h;for(n.commands.formatInline.exec(u,r,i,y,k),l=p.querySelectorAll(i+"."+y),v=l.length;a<v;a++){e=l[a],e.removeAttribute("class");for(h in f)e.setAttribute(h,f[h])}o=e,v===1&&(c=t.getTextContent(e),b=!!e.querySelector("*"),w=c===""||c===n.INVISIBLE_SPACE,!b&&w&&(t.setTextContent(e,f.text||e.href),s=p.createTextNode(" "),u.selection.setAfter(e),u.selection.insertNode(s),o=s)),u.selection.setAfter(o)}var r,i="A",t=n.dom;n.commands.createLink={exec:function(n,t,i){var r=this.state(n,t);r?n.selection.executeAndRestore(function(){f(n,r)}):(i=typeof i=="object"?i:{href:i},u(n,i))},state:function(t,i){return n.commands.formatInline.state(t,i,"A")},value:function(){return r}}}(wysihtml5),function(n){var i,t=/wysiwyg-font-size-[a-z\-]+/g;n.commands.fontSize={exec:function(i,r,u){return n.commands.formatInline.exec(i,r,"span","wysiwyg-font-size-"+u,t)},state:function(i,r,u){return n.commands.formatInline.state(i,r,"span","wysiwyg-font-size-"+u,t)},value:function(){return i}}}(wysihtml5),function(n){var i,t=/wysiwyg-color-[a-z]+/g;n.commands.foreColor={exec:function(i,r,u){return n.commands.formatInline.exec(i,r,"span","wysiwyg-color-"+u,t)},state:function(i,r,u){return n.commands.formatInline.state(i,r,"span","wysiwyg-color-"+u,t)},value:function(){return i}}}(wysihtml5),function(n){function p(n,t,i){n.className?(h(n,i),n.className+=" "+t):n.className=t}function h(n,t){n.className=n.className.replace(t,"")}function o(t){return t.nodeType===n.TEXT_NODE&&!n.lang.string(t.data).trim()}function u(n){for(var t=n.previousSibling;t&&o(t);)t=t.previousSibling;return t}function f(n){for(var t=n.nextSibling;t&&o(t);)t=t.nextSibling;return t}function y(n){var r=n.ownerDocument,t=f(n),i=u(n);t&&!e(t)&&n.parentNode.insertBefore(r.createElement("br"),t),i&&!e(i)&&n.parentNode.insertBefore(r.createElement("br"),n)}function b(n){var i=f(n),t=u(n);i&&r(i)&&i.parentNode.removeChild(i),t&&r(t)&&t.parentNode.removeChild(t)}function w(n){var t=n.lastChild;t&&r(t)&&t.parentNode.removeChild(t)}function r(n){return n.nodeName==="BR"}function e(n){return r(n)?!0:t.getStyle("display").from(n)==="block"?!0:!1}function v(i,r,u,f){if(f)var e=t.observe(i,"DOMNodeInserted",function(i){var r=i.target,u;r.nodeType===n.ELEMENT_NODE&&(u=t.getStyle("display").from(r),u.substr(0,6)!=="inline"&&(r.className+=" "+f))});i.execCommand(r,!1,u),e&&e.stop()}function l(n,t){n.selection.selectLine(),n.selection.surround(t),b(t),w(t),n.selection.selectNode(t)}function a(t){return!!n.lang.string(t.className).trim()}var c,t=n.dom,i="DIV",s=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE",i];n.commands.formatBlock={exec:function(r,u,f,e,o){var b=r.doc,c=this.state(r,u,f,e,o),w;if(f=typeof f=="string"?f.toUpperCase():f,c){r.selection.executeAndRestoreSimple(function(){o&&h(c,o);var n=a(c);n||c.nodeName!==(f||i)?n&&t.renameElement(c,i):(y(c),t.replaceWithChildNodes(c))});return}if((f===null||n.lang.array(s).contains(f))&&(w=r.selection.getSelectedNode(),c=t.getParentElement(w,{nodeName:s}),c)){r.selection.executeAndRestoreSimple(function(){f&&(c=t.renameElement(c,f)),e&&p(c,e,o)});return}if(r.commands.support(u)){v(b,u,f||i,e);return}c=b.createElement(f||i),e&&(c.className=e),l(r,c)},state:function(n,i,r,u,f){r=typeof r=="string"?r.toUpperCase():r;var e=n.selection.getSelectedNode();return t.getParentElement(e,{nodeName:r,className:u,classRegExp:f})},value:function(){return c}}}(wysihtml5),function(n){function f(n){var t=r[n];return t?[n.toLowerCase(),t.toLowerCase()]:[n.toLowerCase()]}function i(i,r,u){var e=i+":"+r;return t[e]||(t[e]=new n.selection.HTMLApplier(f(i),r,u,!0)),t[e]}var u,r={strong:"b",em:"i",b:"strong",i:"em"},t={};n.commands.formatInline={exec:function(n,t,r,u,f){var e=n.selection.getRange();if(!e)return!1;i(r,u,f).toggleRange(e),n.selection.setSelection(e)},state:function(t,u,f,e,o){var h=t.doc,c=r[f]||f,s;return!n.dom.hasElementWithTagName(h,f)&&!n.dom.hasElementWithTagName(h,c)?!1:e&&!n.dom.hasElementWithClassName(h,e)?!1:(s=t.selection.getRange(),!s)?!1:i(f,e,o).isAppliedToRange(s)},value:function(){return u}}}(wysihtml5),function(n){var t;n.commands.insertHTML={exec:function(n,t,i){n.commands.support(t)?n.doc.execCommand(t,!1,i):n.selection.insertHTML(i)},state:function(){return!1},value:function(){return t}}}(wysihtml5),function(n){var t="IMG";n.commands.insertImage={exec:function(i,r,u){u=typeof u=="object"?u:{src:u};var h=i.doc,f=this.state(i),s,o,e;if(f){i.selection.setBefore(f),e=f.parentNode,e.removeChild(f),n.dom.removeEmptyTextNodes(e),e.nodeName!=="A"||e.firstChild||(i.selection.setAfter(e),e.parentNode.removeChild(e)),n.quirks.redraw(i.element);return}f=h.createElement(t);for(o in u)f[o]=u[o];i.selection.insertNode(f),n.browser.hasProblemsSettingCaretAfterImg()?(s=h.createTextNode(n.INVISIBLE_SPACE),i.selection.insertNode(s),i.selection.setAfter(s)):i.selection.setAfter(f)},state:function(i){var e=i.doc,r,u,f;return n.dom.hasElementWithTagName(e,t)?(r=i.selection.getSelectedNode(),!r)?!1:r.nodeName===t?r:r.nodeType!==n.ELEMENT_NODE?!1:(u=i.selection.getText(),u=n.lang.string(u).trim(),u)?!1:(f=i.selection.getNodes(n.ELEMENT_NODE,function(n){return n.nodeName==="IMG"}),f.length!==1)?!1:f[0]:!1},value:function(n){var t=this.state(n);return t&&t.src}}}(wysihtml5),function(n){var i,t="<br>"+(n.browser.needsSpaceAfterLineBreak()?" ":"");n.commands.insertLineBreak={exec:function(i,r){i.commands.support(r)?(i.doc.execCommand(r,!1,null),n.browser.autoScrollsToCaret()||i.selection.scrollIntoView()):i.commands.exec("insertHTML",t)},state:function(){return!1},value:function(){return i}}}(wysihtml5),function(n){var t;n.commands.insertOrderedList={exec:function(t,i){var e=t.doc,s=t.selection.getSelectedNode(),r=n.dom.getParentElement(s,{nodeName:"OL"}),h=n.dom.getParentElement(s,{nodeName:"UL"}),o="_wysihtml5-temp-"+ +new Date,f,u;if(t.commands.support(i)){e.execCommand(i,!1,null);return}r?t.selection.executeAndRestoreSimple(function(){n.dom.resolveList(r)}):h?t.selection.executeAndRestoreSimple(function(){n.dom.renameElement(h,"ol")}):(t.commands.exec("formatBlock","div",o),u=e.querySelector("."+o),f=u.innerHTML===""||u.innerHTML===n.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){r=n.dom.convertToList(u,"ol")}),f&&t.selection.selectNode(r.querySelector("li")))},state:function(t){var i=t.selection.getSelectedNode();return n.dom.getParentElement(i,{nodeName:"OL"})},value:function(){return t}}}(wysihtml5),function(n){var t;n.commands.insertUnorderedList={exec:function(t,i){var e=t.doc,s=t.selection.getSelectedNode(),r=n.dom.getParentElement(s,{nodeName:"UL"}),h=n.dom.getParentElement(s,{nodeName:"OL"}),o="_wysihtml5-temp-"+ +new Date,f,u;if(t.commands.support(i)){e.execCommand(i,!1,null);return}r?t.selection.executeAndRestoreSimple(function(){n.dom.resolveList(r)}):h?t.selection.executeAndRestoreSimple(function(){n.dom.renameElement(h,"ul")}):(t.commands.exec("formatBlock","div",o),u=e.querySelector("."+o),f=u.innerHTML===""||u.innerHTML===n.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){r=n.dom.convertToList(u,"ul")}),f&&t.selection.selectNode(r.querySelector("li")))},state:function(t){var i=t.selection.getSelectedNode();return n.dom.getParentElement(i,{nodeName:"UL"})},value:function(){return t}}}(wysihtml5),function(n){var t;n.commands.italic={exec:function(t,i){return n.commands.formatInline.exec(t,i,"i")},state:function(t,i){return n.commands.formatInline.state(t,i,"i")},value:function(){return t}}}(wysihtml5),function(n){var r,t="wysiwyg-text-align-center",i=/wysiwyg-text-align-[a-z]+/g;n.commands.justifyCenter={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,t,i)},value:function(){return r}}}(wysihtml5),function(n){var r,t="wysiwyg-text-align-left",i=/wysiwyg-text-align-[a-z]+/g;n.commands.justifyLeft={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,t,i)},value:function(){return r}}}(wysihtml5),function(n){var r,t="wysiwyg-text-align-right",i=/wysiwyg-text-align-[a-z]+/g;n.commands.justifyRight={exec:function(r){return n.commands.formatBlock.exec(r,"formatBlock",null,t,i)},state:function(r){return n.commands.formatBlock.state(r,"formatBlock",null,t,i)},value:function(){return r}}}(wysihtml5),function(n){var t;n.commands.underline={exec:function(t,i){return n.commands.formatInline.exec(t,i,"u")},state:function(t,i){return n.commands.formatInline.state(t,i,"u")},value:function(){return t}}}(wysihtml5),function(n){function f(n){for(var t;t=n.querySelector("._wysihtml5-temp");)t.parentNode.removeChild(t)}var i=90,o=89,e=8,h=46,s=40,r='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"<\/span>",u='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"<\/span>",t=n.dom;n.UndoManager=n.lang.Dispatcher.extend({constructor:function(n){this.editor=n,this.composer=n.composer,this.element=this.composer.element,this.history=[this.composer.getValue()],this.position=1,this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var s=this,c=this.composer.sandbox.getDocument(),a,y,v,l;t.observe(this.element,"keydown",function(n){if(!n.altKey&&(n.ctrlKey||n.metaKey)){var t=n.keyCode,u=t===i&&!n.shiftKey,r=t===i&&n.shiftKey||t===o;u?(s.undo(),n.preventDefault()):r&&(s.redo(),n.preventDefault())}}),t.observe(this.element,"keydown",function(n){var t=n.keyCode;t!==a&&(a=t,(t===e||t===h)&&s.transact())}),n.browser.hasUndoInContextMenu()&&(l=function(){f(c),clearInterval(y)},t.observe(this.element,"contextmenu",function(){l(),s.composer.selection.executeAndRestoreSimple(function(){s.element.lastChild&&s.composer.selection.setAfter(s.element.lastChild),c.execCommand("insertHTML",!1,r),c.execCommand("insertHTML",!1,u),c.execCommand("undo",!1,null)}),y=setInterval(function(){c.getElementById("_wysihtml5-redo")?(l(),s.redo()):c.getElementById("_wysihtml5-undo")||(l(),s.undo())},400),v||(v=!0,t.observe(document,"mousedown",l),t.observe(c,["mousedown","paste","cut","copy"],l))})),this.editor.observe("newword:composer",function(){s.transact()}).observe("beforecommand:composer",function(){s.transact()})},transact:function(){var i=this.history[this.position-1],t=this.composer.getValue(),n;t!=i&&(n=this.history.length=this.position,n>s&&(this.history.shift(),this.position--),this.position++,this.history.push(t))},undo:function(){(this.transact(),this.position<=1)||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(n){this.composer.setValue(n),this.editor.focus(!0)}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(n,t,i){this.parent=n,this.element=t,this.config=i,this._observeViewChange()},_observeViewChange:function(){var n=this;this.parent.observe("beforeload",function(){n.parent.observe("change_view",function(t){t===n.name?(n.parent.currentView=n,n.show(),setTimeout(function(){n.focus()},0)):n.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(n){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(n){var t=n.dom,i=n.browser;n.views.Composer=n.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(n,t,i){this.base(n,t,i),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var i=this.isEmpty()?"":n.quirks.getCorrectInnerHTML(this.element);return t&&(i=this.parent.parse(i)),i=n.lang.string(i).replace(n.INVISIBLE_SPACE).by("")},setValue:function(n,t){t&&(n=this.parent.parse(n)),this.element.innerHTML=n},show:function(){this.iframe.style.display=this._displayStyle||"",this.disable(),this.enable()},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe),this._displayStyle==="none"&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable"),this.base()},enable:function(){this.element.setAttribute("contentEditable","true"),this.base()},focus:function(t){n.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var i=this.element.lastChild;t&&i&&(i.nodeName==="BR"?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var n=this.element.innerHTML,t="blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea";return n===""||n===this.CARET_HACK||this.hasPlaceholderSet()||this.getTextContent()===""&&!this.element.querySelector(t)},_initSandbox:function(){var r=this,n,i;this.sandbox=new t.Sandbox(function(){r._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe(),n=document.createElement("input"),n.type="hidden",n.name="_wysihtml5_mode",n.value=1,i=this.textarea.element,t.insert(this.iframe).after(i),t.insert(n).after(i)},_create:function(){var f=this,r,u;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.enable(),this.selection=new n.Selection(this.parent),this.commands=new n.Commands(this.parent),t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe(),r=this.config.name,r&&(t.addClass(this.element,r),t.addClass(this.iframe,r)),u=typeof this.config.placeholder=="string"?this.config.placeholder:this.textarea.element.getAttribute("placeholder"),u&&t.simulatePlaceholder(this.parent,this,u),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){f.focus()},100),n.quirks.insertLineBreakOnReturn(this),i.clearsContentEditableCorrectly()||n.quirks.ensureProperClearing(this),i.clearsListsInContentEditableCorrectly()||n.quirks.ensureProperClearingOfLists(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var f=this,e=i.canDisableAutoLinking(),r=i.doesAutoLinkingInContentEditable();if(e&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!r||r&&e)&&this.parent.observe("newword:composer",function(){f.selection.executeAndRestore(function(n,i){t.autoLink(i.parentNode)})});var o=this.sandbox.getDocument().getElementsByTagName("a"),s=t.autoLink.URL_REG_EXP,u=function(i){var r=n.lang.string(t.getTextContent(i)).trim();return r.substr(0,4)==="www."&&(r="http://"+r),r};t.observe(this.element,"keydown",function(n){if(o.length){var e=f.selection.getSelectedNode(n.target.ownerDocument),i=t.getParentElement(e,{nodeName:"A"},4),r;i&&(r=u(i),setTimeout(function(){var n=u(i);n!==r&&n.match(s)&&i.setAttribute("href",n)},0))}})}},_initObjectResizing:function(){var u=["width","height"],f=u.length,r=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing),this.config.allowObjectResizing?i.supportsEvent("resizeend")&&t.observe(r,"resizeend",function(t){for(var s=t.target||t.srcElement,e=s.style,o=0,i;o<f;o++)i=u[o],e[i]&&(s.setAttribute(i,parseInt(e[i],10)),e[i]="");n.quirks.redraw(r)}):i.supportsEvent("resizestart")&&t.observe(r,"resizestart",function(n){n.preventDefault()})},_initUndoManager:function(){new n.UndoManager(this.parent)}})}(wysihtml5),function(n){var t=n.dom,i=document,u=window,e=i.createElement("div"),r=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],f=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],h=["width","height","top","left","right","bottom"],s=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",n.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],o=function(n){if(n.setActive)try{n.setActive()}catch(s){}else{var r=n.style,o=i.documentElement.scrollTop||i.body.scrollTop,e=i.documentElement.scrollLeft||i.body.scrollLeft,f={position:r.position,top:r.top,left:r.left,WebkitUserSelect:r.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(n);n.focus();t.setStyles(f).on(n);u.scrollTo&&u.scrollTo(e,o)}};n.views.Composer.prototype.style=function(){var l=this,y=i.querySelector(":focus"),c=this.textarea.element,v=c.hasAttribute("placeholder"),w=v&&c.getAttribute("placeholder"),a,p;return this.focusStylesHost=this.focusStylesHost||e.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||e.cloneNode(!1),v&&c.removeAttribute("placeholder"),c===y&&c.blur(),t.copyStyles(f).from(c).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(r).from(c).to(this.element).andTo(this.blurStylesHost),t.insertCSS(s).into(this.element.ownerDocument),o(c),t.copyStyles(f).from(c).to(this.focusStylesHost),t.copyStyles(r).from(c).to(this.focusStylesHost),a=n.lang.array(f).without(["display"]),y?y.focus():c.blur(),v&&c.setAttribute("placeholder",w),n.browser.hasCurrentStyleProperty()||(p=t.observe(u,"resize",function(){if(!t.contains(document.documentElement,l.iframe)){p.stop();return}var i=t.getStyle("display").from(c),n=t.getStyle("display").from(l.iframe);c.style.display="",l.iframe.style.display="none",t.copyStyles(h).from(c).to(l.iframe).andTo(l.focusStylesHost).andTo(l.blurStylesHost),l.iframe.style.display=n,c.style.display=i})),this.parent.observe("focus:composer",function(){t.copyStyles(a).from(l.focusStylesHost).to(l.iframe),t.copyStyles(r).from(l.focusStylesHost).to(l.element)}),this.parent.observe("blur:composer",function(){t.copyStyles(a).from(l.blurStylesHost).to(l.iframe),t.copyStyles(r).from(l.blurStylesHost).to(l.element)}),this}}(wysihtml5),function(n){var t=n.dom,i=n.browser,r={"66":"bold","73":"italic","85":"underline"};n.views.Composer.prototype.observe=function(){var u=this,c=this.getValue(),h=this.sandbox.getIframe(),f=this.element,s=i.supportsEventsInIframeCorrectly()?f:this.sandbox.getWindow(),l=i.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"],e,o;t.observe(h,"DOMNodeRemoved",function(){clearInterval(e),u.parent.fire("destroy:composer")}),e=setInterval(function(){t.contains(document.documentElement,h)||(clearInterval(e),u.parent.fire("destroy:composer"))},250),t.observe(s,"focus",function(){u.parent.fire("focus").fire("focus:composer"),setTimeout(function(){c=u.getValue()},0)}),t.observe(s,"blur",function(){c!==u.getValue()&&u.parent.fire("change").fire("change:composer"),u.parent.fire("blur").fire("blur:composer")}),n.browser.isIos()&&t.observe(f,"blur",function(){var n=f.ownerDocument.createElement("input"),i=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.scrollLeft||document.body.scrollLeft;try{u.selection.insertNode(n)}catch(r){f.appendChild(n)}n.focus(),n.parentNode.removeChild(n),window.scrollTo(t,i)}),t.observe(f,"dragenter",function(){u.parent.fire("unset_placeholder")}),i.firesOnDropOnlyWhenOnDragOverIsCancelled()&&t.observe(f,["dragover","dragenter"],function(n){n.preventDefault()}),t.observe(f,l,function(n){var r=n.dataTransfer,t;r&&i.supportsDataTransfer()&&(t=r.getData("text/html")||r.getData("text/plain")),t?(f.focus(),u.commands.exec("insertHTML",t),u.parent.fire("paste").fire("paste:composer"),n.stopPropagation(),n.preventDefault()):setTimeout(function(){u.parent.fire("paste").fire("paste:composer")},0)}),t.observe(f,"keyup",function(t){var i=t.keyCode;(i===n.SPACE_KEY||i===n.ENTER_KEY)&&u.parent.fire("newword:composer")}),this.parent.observe("paste:composer",function(){setTimeout(function(){u.parent.fire("newword:composer")},0)}),i.canSelectImagesInContentEditable()||t.observe(f,"mousedown",function(n){var t=n.target;t.nodeName==="IMG"&&(u.selection.selectNode(t),n.preventDefault())}),t.observe(f,"keydown",function(n){var i=n.keyCode,t=r[i];(n.ctrlKey||n.metaKey)&&!n.altKey&&t&&(u.commands.exec(t),n.preventDefault())}),t.observe(f,"keydown",function(t){var r=u.selection.getSelectedNode(!0),e=t.keyCode,i;r&&r.nodeName==="IMG"&&(e===n.BACKSPACE_KEY||e===n.DELETE_KEY)&&(i=r.parentNode,i.removeChild(r),i.nodeName!=="A"||i.firstChild||i.parentNode.removeChild(i),setTimeout(function(){n.quirks.redraw(f)},0),t.preventDefault())}),o={IMG:"Image: ",A:"Link: "},t.observe(f,"mouseover",function(n){var t=n.target,i=t.nodeName,u,r;(i==="A"||i==="IMG")&&(r=t.hasAttribute("title"),r||(u=o[i]+(t.getAttribute("href")||t.getAttribute("src")),t.setAttribute("title",u)))})}}(wysihtml5),function(n){var t=400;n.views.Synchronizer=Base.extend({constructor:function(n,t,i){this.editor=n,this.textarea=t,this.composer=i,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(n.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(n){var t=this.textarea.getValue();t?this.composer.setValue(t,n):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(n){this.editor.currentView.name==="textarea"?this.fromTextareaToComposer(n):this.fromComposerToTextarea(n)},_observe:function(){var r,i=this,u=this.textarea.element.form,e=function(){r=setInterval(function(){i.fromComposerToTextarea()},t)},f=function(){clearInterval(r),r=null};e(),u&&(n.dom.observe(u,"submit",function(){i.sync(!0)}),n.dom.observe(u,"reset",function(){setTimeout(function(){i.fromTextareaToComposer()},0)})),this.editor.observe("change_view",function(n){n!=="composer"||r?n==="textarea"&&(i.fromComposerToTextarea(!0),f()):(i.fromTextareaToComposer(!0),e())}),this.editor.observe("destroy:composer",f)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(n,t,i){this.base(n,t,i),this._observe()},clear:function(){this.element.value=""},getValue:function(n){var t=this.isEmpty()?"":this.element.value;return n&&(t=this.parent.parse(t)),t},setValue:function(n,t){t&&(n=this.parent.parse(n)),this.element.value=n},hasPlaceholderSet:function(){var i=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),r=this.element.getAttribute("placeholder")||null,n=this.element.value,t=!n;return i&&t||n===r},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var t=this.element,n=this.parent,r={focusin:"focus",focusout:"blur"},i=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];n.observe("beforeload",function(){wysihtml5.dom.observe(t,i,function(t){var i=r[t.type]||t.type;n.fire(i).fire(i+":textarea")}),wysihtml5.dom.observe(t,["paste","drop"],function(){setTimeout(function(){n.fire("paste").fire("paste:textarea")},0)})})}}),function(n){var t=n.dom,i="wysihtml5-command-dialog-opened",f="input, select, textarea",u="[data-wysihtml5-dialog-field]",r="data-wysihtml5-dialog-field";n.toolbar.Dialog=n.lang.Dispatcher.extend({constructor:function(n,t){this.link=n,this.container=t},_observe:function(){var r,e;if(!this._observed){r=this,e=function(n){var t=r._serialize();t==r.elementToChange?r.fire("edit",t):r.fire("save",t),r.hide(),n.preventDefault(),n.stopPropagation()},t.observe(r.link,"click",function(){t.hasClass(r.link,i)&&setTimeout(function(){r.hide()},0)}),t.observe(this.container,"keydown",function(t){var i=t.keyCode;i===n.ENTER_KEY&&e(t),i===n.ESCAPE_KEY&&r.hide()}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",e),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(n){r.fire("cancel"),r.hide(),n.preventDefault(),n.stopPropagation()});for(var o=this.container.querySelectorAll(f),u=0,h=o.length,s=function(){clearInterval(r.interval)};u<h;u++)t.observe(o[u],"change",s);this._observed=!0}},_serialize:function(){for(var i=this.elementToChange||{},t=this.container.querySelectorAll(u),f=t.length,n=0;n<f;n++)i[t[n].getAttribute(r)]=t[n].value;return i},_interpolate:function(n){for(var t,o,e,s=document.querySelector(":focus"),f=this.container.querySelectorAll(u),h=f.length,i=0;i<h;i++)(t=f[i],t!==s)&&(n&&t.type==="hidden"||(o=t.getAttribute(r),e=this.elementToChange?this.elementToChange[o]||"":t.defaultValue,t.value=e))},show:function(n){var u=this,r=this.container.querySelector(f);if(this.elementToChange=n,this._observe(),this._interpolate(),n&&(this.interval=setInterval(function(){u._interpolate(!0)},500)),t.addClass(this.link,i),this.container.style.display="",this.fire("show"),r&&!n)try{r.focus()}catch(e){}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,i),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(n){var t=n.dom,f={position:"relative"},i={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},u={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},r={"x-webkit-speech":"",speech:""};n.toolbar.Speech=function(e,o){var s=document.createElement("input"),h,c;if(!n.browser.supportsSpeechApiOn(s)){o.style.display="none";return}h=document.createElement("div"),n.lang.object(i).merge({width:o.offsetWidth+"px",height:o.offsetHeight+"px"}),t.insert(s).into(h),t.insert(h).into(o);t.setStyles(u).on(s);t.setAttributes(r).on(s);t.setStyles(i).on(h);t.setStyles(f).on(o);c="onwebkitspeechchange"in s?"webkitspeechchange":"speechchange",t.observe(s,c,function(){e.execCommand("insertText",s.value),s.value=""}),t.observe(s,"click",function(n){t.hasClass(o,"wysihtml5-command-disabled")&&n.preventDefault(),n.stopPropagation()})}}(wysihtml5),function(n){var f="wysihtml5-command-disabled",r="wysihtml5-commands-disabled",i="wysihtml5-command-active",u="wysihtml5-action-active",t=n.dom;n.toolbar.Toolbar=Base.extend({constructor:function(t,i){this.editor=t,this.container=typeof i=="string"?document.getElementById(i):i,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var u=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),f=u.length,r=0;r<f;r++)new n.toolbar.Speech(this,u[r])},_getLinks:function(t){for(var o=this[t+"Links"]=n.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),c=o.length,f=0,h=this[t+"Mapping"]={},i,e,r,u,s;f<c;f++)i=o[f],r=i.getAttribute("data-wysihtml5-"+t),u=i.getAttribute("data-wysihtml5-"+t+"-value"),e=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+r+"']"),s=this._getDialog(i,r),h[r+":"+u]={link:i,group:e,name:r,value:u,dialog:s,state:!1}},_getDialog:function(t,i){var r=this,f=this.container.querySelector("[data-wysihtml5-dialog='"+i+"']"),u,e;return f&&(u=new n.toolbar.Dialog(t,f),u.observe("show",function(){e=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:i,dialogContainer:f,commandLink:t})}),u.observe("save",function(n){e&&r.composer.selection.setBookmark(e),r._execCommand(i,n),r.editor.fire("save:dialog",{command:i,dialogContainer:f,commandLink:t})}),u.observe("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:i,dialogContainer:f,commandLink:t})})),u},execCommand:function(n,t){if(!this.commandsDisabled){var i=this.commandMapping[n+":"+t];i&&i.dialog&&!i.state?i.dialog.show():this._execCommand(n,t)}},_execCommand:function(n,t){this.editor.focus(!1),this.composer.commands.exec(n,t),this._updateLinkStates()},execAction:function(n){var t=this.editor;switch(n){case"change_view":t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")}},_observe:function(){for(var n=this,u=this.editor,i=this.container,e=this.commandLinks.concat(this.actionLinks),o=e.length,f=0;f<o;f++)t.setAttributes({href:"javascript:;",unselectable:"on"}).on(e[f]);t.delegate(i,"[data-wysihtml5-command]","mousedown",function(n){n.preventDefault()}),t.delegate(i,"[data-wysihtml5-command]","click",function(t){var i=this,u=i.getAttribute("data-wysihtml5-command"),r=i.getAttribute("data-wysihtml5-command-value");n.execCommand(u,r),t.preventDefault()}),t.delegate(i,"[data-wysihtml5-action]","click",function(t){var i=this.getAttribute("data-wysihtml5-action");n.execAction(i),t.preventDefault()}),u.observe("focus:composer",function(){n.bookmark=null,clearInterval(n.interval),n.interval=setInterval(function(){n._updateLinkStates()},500)}),u.observe("blur:composer",function(){clearInterval(n.interval)}),u.observe("destroy:composer",function(){clearInterval(n.interval)}),u.observe("change_view",function(u){setTimeout(function(){n.commandsDisabled=u!=="composer",n._updateLinkStates(),n.commandsDisabled?t.addClass(i,r):t.removeClass(i,r)},0)})},_updateLinkStates:function(){var l=this.composer.element,h=this.commandMapping,c=this.actionMapping,s,e,o,r;for(s in h)(r=h[s],this.commandsDisabled?(e=!1,t.removeClass(r.link,i),r.group&&t.removeClass(r.group,i),r.dialog&&r.dialog.hide()):(e=this.composer.commands.state(r.name,r.value),n.lang.object(e).isArray()&&(e=e.length===1?e[0]:!0),t.removeClass(r.link,f),r.group&&t.removeClass(r.group,f)),r.state!==e)&&(r.state=e,e?(t.addClass(r.link,i),r.group&&t.addClass(r.group,i),r.dialog&&(typeof e=="object"?r.dialog.show(e):r.dialog.hide())):(t.removeClass(r.link,i),r.group&&t.removeClass(r.group,i),r.dialog&&r.dialog.hide()));for(s in c)o=c[s],o.name==="change_view"&&(o.state=this.editor.currentView===this.editor.textarea,o.state?t.addClass(o.link,u):t.removeClass(o.link,u))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(n){var t,i={name:t,style:!0,toolbar:t,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:n.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:t,allowObjectResizing:!0,supportTouchDevices:!0};n.Editor=n.lang.Dispatcher.extend({constructor:function(t,r){if(this.textareaElement=typeof t=="string"?document.getElementById(t):t,this.config=n.lang.object({}).merge(i).merge(r).get(),this.textarea=new n.views.Textarea(this,this.textareaElement,this.config),this.currentView=this.textarea,this._isCompatible=n.browser.supported(),!this._isCompatible||!this.config.supportTouchDevices&&n.browser.isTouchDevice()){var u=this;setTimeout(function(){u.fire("beforeload").fire("load")},0);return}n.dom.addClass(document.body,this.config.bodyClassName),this.composer=new n.views.Composer(this,this.textareaElement,this.config),this.currentView=this.composer,typeof this.config.parser=="function"&&this._initParser(),this.observe("beforeload",function(){this.synchronizer=new n.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new n.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(f){}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(n){return this.currentView.getValue(n)},setValue:function(n,t){return n?(this.currentView.setValue(n,t),this):this.clear()},focus:function(n){return this.currentView.focus(n),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var i=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return typeof t=="object"&&n.quirks.redraw(t),i},_initParser:function(){this.observe("paste:composer",function(){var i=!0,t=this;t.composer.selection.executeAndRestore(function(){n.quirks.cleanPastedHTML(t.composer.element),t.parse(t.composer.element)},i)}),this.observe("paste:textarea",function(){var t=this.textarea.getValue(),n;n=this.parse(t),this.textarea.setValue(n)})}})}(wysihtml5),!function(n,t){"use strict";var u={"font-styles":"<li class='dropdown'><a class='btn dropdown-toggle' data-toggle='dropdown' href='#'><i class='icon-font'><\/i>&nbsp;<span class='current-font'>Normal text<\/span>&nbsp;<b class='caret'><\/b><\/a><ul class='dropdown-menu'><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div'>Normal text<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1'>Heading 1<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2'>Heading 2<\/a><\/li><\/ul><\/li>",emphasis:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='bold' title='CTRL+B'>Bold<\/a><a class='btn' data-wysihtml5-command='italic' title='CTRL+I'>Italic<\/a><\/div><\/li>",lists:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='insertUnorderedList' title='Unordered List'><i class='icon-list'><\/i><\/a><a class='btn' data-wysihtml5-command='insertOrderedList' title='Ordered List'><i class='icon-th-list'><\/i><\/a><a class='btn' data-wysihtml5-command='Outdent' title='Outdent'><i class='icon-indent-right'><\/i><\/a><a class='btn' data-wysihtml5-command='Indent' title='Indent'><i class='icon-indent-left'><\/i><\/a><\/div><\/li>",link:"<li><div class='bootstrap-wysihtml5-insert-link-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>ï¿½<\/a><h3>Insert Link<\/h3><\/div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-link-url input-xlarge'><\/div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel<\/a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert link<\/a><\/div><\/div><a class='btn' data-wysihtml5-command='createLink' title='Link'><i class='icon-share'><\/i><\/a><\/li>",image:"<li><div class='bootstrap-wysihtml5-insert-image-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>ï¿½<\/a><h3>Insert Image<\/h3><\/div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-image-url input-xlarge'><\/div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel<\/a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert image<\/a><\/div><\/div><a class='btn' data-wysihtml5-command='insertImage' title='Insert image'><i class='icon-picture'><\/i><\/a><\/li>",html:"<li><div class='btn-group'><a class='btn' data-wysihtml5-action='change_view' title='Edit HTML'><i class='icon-pencil'><\/i><\/a><\/div><\/li>"},i={"font-styles":!0,emphasis:!0,lists:!0,html:!1,link:!0,image:!0,events:{},parserRules:{tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{set_attributes:{target:"_blank",rel:"nofollow"},check_attributes:{href:"url"}}}}},r=function(t,r){this.el=t,this.toolbar=this.createToolbar(t,r||i),this.editor=this.createEditor(r),window.editor=this.editor,n("iframe.wysihtml5-sandbox").each(function(t,i){n(i.contentWindow).off("focus.wysihtml5").on({"focus.wysihtml5":function(){n("li.dropdown").removeClass("open")}})})};r.prototype={constructor:r,createEditor:function(n){var f=i.parserRules,r,u;if(n&&n.parserRules&&(f=n.parserRules),r=new t.Editor(this.el.attr("id"),{toolbar:this.toolbar.attr("id"),parserRules:f}),n&&n.events)for(u in n.events)r.on(u,n.events[u]);return r},createToolbar:function(t,r){var s=this,e=n("<ul/>",{id:t.attr("id")+"-wysihtml5-toolbar","class":"wysihtml5-toolbar",style:"display:none"}),f,o;for(f in i)o=!1,r[f]!=undefined?r[f]==!0&&(o=!0):o=i[f],o==!0&&(e.append(u[f]),f=="html"&&this.initHtml(e),f=="link"&&this.initInsertLink(e),f=="image"&&this.initInsertImage(e));return s=this,e.find("a[data-wysihtml5-command='formatBlock']").click(function(t){var i=n(t.srcElement);s.toolbar.find(".current-font").text(i.html())}),this.el.before(e),e},initHtml:function(n){var t="a[data-wysihtml5-action='change_view']";n.find(t).click(function(){n.find("a.btn").not(t).toggleClass("disabled")})},initInsertImage:function(n){var u=this,t=n.find(".bootstrap-wysihtml5-insert-image-modal"),i=t.find(".bootstrap-wysihtml5-insert-image-url"),f=t.find("a.btn-primary"),e=i.val(),r=function(){var n=i.val();i.val(e),u.editor.composer.commands.exec("insertImage",n)};i.keypress(function(n){n.which==13&&(r(),t.modal("hide"))}),f.click(r);t.on("shown",function(){i.focus()});t.on("hide",function(){u.editor.currentView.element.focus()});n.find("a[data-wysihtml5-command=insertImage]").click(function(){t.modal("show")})},initInsertLink:function(n){var u=this,t=n.find(".bootstrap-wysihtml5-insert-link-modal"),i=t.find(".bootstrap-wysihtml5-insert-link-url"),e=t.find("a.btn-primary"),f=i.val(),r=function(){var n=i.val();i.val(f),u.editor.composer.commands.exec("createLink",{href:n,target:"_blank",rel:"nofollow"})},o=!1;i.keypress(function(n){n.which==13&&(r(),t.modal("hide"))}),e.click(r);t.on("shown",function(){i.focus()});t.on("hide",function(){u.editor.currentView.element.focus()});n.find("a[data-wysihtml5-command=createLink]").click(function(){t.modal("show")})}},n.fn.wysihtml5=function(t){return this.each(function(){var i=n(this);i.data("wysihtml5",new r(i,t))})},n.fn.wysihtml5.Constructor=r}(window.jQuery,window.wysihtml5)